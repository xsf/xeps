<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE xep SYSTEM 'xep.dtd' [
  <!ENTITY namespace "urn:xmpp:notification-settings:1">
  <!ENTITY xep-number "0492">
  <!ENTITY % ents SYSTEM 'xep.ent'>
%ents;
]>
<?xml-stylesheet type='text/xsl' href='xep.xsl'?>
<xep>
<header>
  <title>Chat notification settings</title>
  <abstract>This document defines an XMPP protocol extension to synchronise per-chat notification settings across different clients.</abstract>
  &LEGALNOTICE;
  <number>&xep-number;</number>
  <status>Experimental</status>
  <type>Standards Track</type>
  <sig>Standards</sig>
  <approver>Council</approver>
  <dependencies>
    <spec>XMPP Core</spec>
    <spec>XMPP IM</spec>
    <spec>XEP-0402</spec>
  </dependencies>
  <supersedes/>
  <supersededby/>
  <shortname>notification-settings</shortname>
  &nicoco;
  &tmolitor;
  <revision>
    <version>0.2.0</version>
    <date>2025-10-25</date>
    <initials>tm</initials>
    <remark>
      <ul>
        <li>Rework the spec to use more of the Service Discovery Identities registry</li>
        <li>Fix the XML schema</li>
        <li>Move the &lt;advanced/&gt; element into the notification setting element</li>
        <li>Bump the namespace</li>
      </ul>
    </remark>
  </revision>
  <revision>
    <version>0.1.0</version>
    <date>2024-07-01</date>
    <initials>XEP Editor: dg</initials>
    <remark>
      <ul>
        <li>Promoted to Experimental</li>
      </ul>
    </remark>
  </revision>
  <revision>
    <version>0.0.2</version>
    <date>2024-06-08</date>
    <initials>nc</initials>
    <remark><p>Update after discussions on the standards@ mailing list.</p></remark>
  </revision>
  <revision>
    <version>0.0.1</version>
    <date>2024-06-06</date>
    <initials>nc</initials>
    <remark><p>Initial version.</p></remark>
  </revision>
</header>
<section1 topic='Introduction' anchor='intro'>
  <p>"Notifications" are (usually) pop-up windows that appear in a visible area of the screen even when the emitting application is in the background, often triggering a sound alert. <em>Instant</em> messaging clients expectedly use notifications to inform users when they receive a message.</p>
  <p>Users may want to customise which conversations should trigger notifications and under which conditions. In practice, this is already implemented in many instant messaging clients, including XMPP clients. This specification proposes a mechanism to synchronise per-discussion notification settings across different XMPP clients and other XMPP based applications.</p>
</section1>
<section1 topic='Protocol' anchor='protocol'>
  <section2 topic='The notify element' anchor='notify'>
  <p>Notification settings are represented by the &lt;notify&gt; element. This element MUST be a child of an element identifying a specific chat by its JID, such as a &xep0402; &lt;extensions&gt;.</p>
  <p>This protocol specifies three notification elements as children for the &lt;notify&gt; element, each corresponding to a notification setting: &lt;always&gt; &lt;on-mention&gt; and &lt;never&gt;. A notification element without attributes is called a "fallback element".</p>
<example caption='Most basic example'><![CDATA[
<notify xmlns=']]>&namespace;<![CDATA['>
  <never />
</notify>
]]></example>
  </section2>
  <section2 topic='Identities' anchor='identities'>
    <p>Applications MAY choose different notification settings depending on their own Service Discovery Identity. In this case, the two optional attributes '<tt>identity-category</tt>' and '<tt>identity-type</tt>' MAY be added to the notification element, using values registered in the Service Discovery Identities registry at &DISCOCATEGORIES;.</p>
    <p>The '<tt>identity-type</tt>' attribute MAY be omitted, if the notification setting should apply to a whole Identity Category. You MUST NOT add the '<tt>identity-type</tt>' attribute without an accompanying '<tt>identity-category</tt>' attribute.</p>
<example caption='An example of notification settings by identity'><![CDATA[
<notify xmlns=']]>&namespace;<![CDATA['>
  <never identity-category="client" identity-type="pc" />
  <on-mention identity-category="client" identity-type="phone" />
  <on-mention identity-category="gateway" />
  <always />
</notify>
]]></example>
  </section2>
  <section2 topic='Advanced notification settings' anchor='advanced'>
  <p>Finally, clients can use this specification to synchronise finer-grained notification settings using custom namespaces in the optional &lt;advanced/&gt; child of the notification elements.</p>
  <p>The &lt;advanced/&gt; element SHOULD NOT be empty.</p>
<example caption='Complex example of finer-grained notification settings'><![CDATA[
<notify xmlns=']]>&namespace;<![CDATA['>
  <never identity-category="client" identity-type="pc">
    <advanced>
      <my-custom-extension xmlns="custom:ns-1">
        <when day-of-week="monday">night-time-only</day-of-week>
        ...
      </custom>
      <cool-custom-extension-2 xmlns="custom:ns-2">
        <weather>raining</weather>
        ...
      </custom>
      ...
    </advanced>
  </never>
  <on-mention identity-category="client" identity-type="phone" />
  <on-mention identity-category="gateway" />
  <always>
    <advanced>
      <better-custom-extension xmlns="custom:ns-3">
        <when day-of-week="saturday" />
        <when day-of-week="sunday" />
        ...
      </custom>
      ...
    </advanced>
  </always>
</notify>
]]></example>
  </section2>
</section1>
<section1 topic='Business Rules' anchor='rules'>
  <p>Applications implementing this specification MUST NOT delete or alter the &lt;advanced /&gt; notification settings they do not support when updating the notification settings for a given conversation.</p>
  <p>When reading the notification settings for a given conversation, applications implementing this specification MUST use the element most specific to their own application identity. Sorted from high to low specifity, this is:</p>
  <ol>
    <li>Matching '<tt>identity-category</tt>' and '<tt>identity-type</tt>' attributes</li>
    <li>Matching '<tt>identity-category</tt>' attribute</li>
    <li>Fallback element without '<tt>identity-category</tt>' and '<tt>identity-type</tt>' attributes</li>
  </ol>
  <p>When writing the notification settings, applications MAY use the '<tt>identity-category</tt>' and '<tt>identity-type</tt>' attributes as described in the <link url="#identities">Identities</link> section. If a fallback element without any attributes isn't present, the application SHOULD add it with the same settings. As secondary fallback, it MAY also add a notification setting having only the '<tt>identity-category</tt>' attribute, if not already present.</p>
  <p>There SHALL NOT be more than one notification element having the same name, attributes and attribute values.</p>
  <p>Applications using the &lt;advanced/&gt; child SHOULD attempt to choose the parent notification element being the closest to what they offer as a fallback for other applications not supporting the advanced settings.</p>
  <p>In the absence of any notification settings for a given conversation, "always" SHOULD be assumed for direct chats and private group chats, and <tt>on-mention</tt> for public group chats.</p>
  <p>The "on-mention" notification MAY rely on the user's nickname being spelled out in an incoming message in a group chat, but SHOULD rely on mechanisms to explicitly "ping" the user, such as a &xep0461; element referring a user's previous message or a specific mention, such as a &xep0372; mention.</p>
</section1>
<section1 topic='Security Considerations' anchor='security'>
  <p>See considerations in &xep0402;.</p>
</section1>
<section1 topic='IANA Considerations' anchor='iana'>
  <p>This document requires no interaction with &IANA;.</p>
</section1>
<section1 topic='XMPP Registrar Considerations' anchor='registrar'>
  <section2 topic='Protocol Namespaces' anchor='registrar-ns'>
    <p>This specification defines the following XML namespace:</p>
    <ul>
      <li>&namespace;</li>
    </ul>
    <p>The &REGISTRAR; includes this namespace in the registry located at &NAMESPACES;, as described in Section 4 of &xep0053;.</p>
  </section2>
  <section2 topic='Protocol Versioning' anchor='registrar-versioning'>
    &NSVER;
  </section2>
</section1>
<section1 topic='XML Schema' anchor='schema'>
  <code><![CDATA[
<?xml version='1.0' encoding='UTF-8'?>

<xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace=']]>&namespace;<![CDATA['
    xmlns=']]>&namespace;<![CDATA['
    elementFormDefault='qualified'>

  <xs:annotation>
    <xs:documentation>
      The protocol documented by this schema is defined in
      XEP-]]>&xep-number;<![CDATA[: http://www.xmpp.org/extensions/xep-]]>&xep-number;<![CDATA[.html
    </xs:documentation>
  </xs:annotation>

  <xs:element name='notify'>
    <xs:complexType>
      <xs:sequence>
        <xs:element name='always' type='setting' minOccurs='0' maxOccurs='unbounded'/>
        <xs:element name='on-mention' type='setting' minOccurs='0' maxOccurs='unbounded'/>
        <xs:element name='never' type='setting' minOccurs='0' maxOccurs='unbounded'/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>

  <xs:complexType name="setting">
    <xs:sequence>
      <xs:element name='advanced' minOccurs='0' maxOccurs='1'>
        <xs:complexType>
          <xs:sequence>
            <xs:any namespace='##other' minOccurs='1' maxOccurs='unbounded' processContents='lax'/>
          </xs:sequence>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
    <xs:attribute name='identity-category' type='xs:string' use='optional'/>
    <xs:attribute name='identity-type' type='xs:string' use='optional'/>
  </xs:complexType>

</xs:schema>
]]></code>
</section1>
</xep>
