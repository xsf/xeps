<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE xep SYSTEM 'xep.dtd' [
  <!ENTITY % ents SYSTEM 'xep.ent'>
%ents;
]>
<?xml-stylesheet type='text/xsl' href='xep.xsl'?>
<xep>
<header>
  <title>vCard4 Over XMPP</title>
  <abstract>This document specifies an XMPP extension for use of the vCard4 XML format in XMPP systems, with the intent of obsoleting the vcard-temp format.</abstract>
  &LEGALNOTICE;
  <number>0292</number>
  <status>Experimental</status>
  <type>Standards Track</type>
  <sig>Standards</sig>
  <approver>Council</approver>
  <dependencies>
    <spec>XMPP Core</spec>
    <spec>draft-ietf-vcarddav-vcardrev</spec>
    <spec>draft-ietf-vcarddav-vcardxml</spec>
  </dependencies>
  <supersedes>
    <spec>XEP-0054</spec>
  </supersedes>
  <supersededby/>
  <shortname>NOT_YET_ASSIGNED</shortname>
  <author>
    <firstname>Samantha</firstname>
    <surname>Mizzi</surname>
    <email>samizzi@cisco.com</email>
    <jid>samizzi@cisco.com</jid>
  </author>
  &stpeter;
  <revision>
    <version>0.4</version>
    <date>2011-06-20</date>
    <initials>psa</initials>
    <remark><p>Defined provisional mapping from vcard-temp to vCard4.</p></remark>
  </revision>
  <revision>
    <version>0.3</version>
    <date>2011-04-07</date>
    <initials>psa</initials>
    <remark><p>Updated to track base vCard4 specs; defined IQ transport, with pubsub for notifications; added examples for server vCards; described several problematic aspects of mapping from vcard-temp.</p></remark>
  </revision>
  <revision>
    <version>0.2</version>
    <date>2011-04-07</date>
    <initials>psa</initials>
    <remark><p>Updated to track base vCard4 specs; defined IQ transport, with pubsub for notifications; added examples for server vCards; specified mapping from vcard-temp.</p></remark>
  </revision>
  <revision>
    <version>0.1</version>
    <date>2011-03-02</date>
    <initials>psa</initials>
    <remark><p>Initial published version.</p></remark>
  </revision>
  <revision>
    <version>0.0.5</version>
    <date>2011-02-28</date>
    <initials>psa</initials>
    <remark><p>Corrected more errors in the examples.</p></remark>
  </revision>
  <revision>
    <version>0.0.4</version>
    <date>2011-02-25</date>
    <initials>psa</initials>
    <remark><p>Corrected some errors in the examples.</p></remark>
  </revision>
  <revision>
    <version>0.0.3</version>
    <date>2011-02-12</date>
    <initials>psa</initials>
    <remark><p>Third draft.</p></remark>
  </revision>
  <revision>
    <version>0.0.2</version>
    <date>2011-01-31</date>
    <initials>srm</initials>
    <remark><p>Second draft.</p></remark>
  </revision>
  <revision>
    <version>0.0.1</version>
    <date>2010-11-30</date>
    <initials>srm</initials>
    <remark><p>First draft.</p></remark>
  </revision>
</header>

<section1 topic='Introduction' anchor='intro'>
  <p>Since 1999, the Jabber/XMPP community has used an interim, unofficial XML representation of vCard data for personal contacts, called &xep0054;. Recently, the IETF has upgraded vCard from vCard3 to &vcardrev;, and at the same time has defined &vcardxml; as an official XML format for vCard4. This document specifies an XMPP extension for use of the vCard4 XML format in XMPP systems, with the intent of obsoleting the vcard-temp format. Primarily this document defines the encapsulation method itself; secondarily it also defines transport methods and a mapping to the vcard-temp format for migration by clients and servers.</p>
</section1>

<section1 topic='Requirements' anchor='reqs'>
  <p>This specification was designed with the following requirements in mind.</p>
  <ol>
    <li>Reuse vCard4 as defined in draft-ietf-vcarddav-vcardrev.</li>
    <li>Reuse the vCard4 XML format as defined in draft-ietf-vcarddav-vcardxml.</li>
    <li>Ensure that clients and servers can easily migrate from vcard-temp to the new encapsulation format.</li>
    <li>Notify interested parties of changes to vCard data using standard XMPP extensions, specifically &xep0163;.</li>
    <li>Support vCards for non-human entities such as XMPP servers and &xep0045; rooms.</li>
    <li>Enable XMPP servers to store vCard4 XML data in LDAP directories if desired.</li>
  </ol>
</section1>

<section1 topic='Reuse of vCard4' anchor='reuse'>
  <p>Because there is now an XML namespace for the official vCard format, we can simply re-use that namespace: "urn:ietf:params:xml:ns:vcard-4.0".</p>
  <p>The vCard XML format defined at the IETF specifies that the root element is &lt;vcards/&gt;, where the only defined child element is &lt;vcard/&gt;. For use in XMPP, we specify that the root element shall be &lt;vcard/&gt;, not &lt;vcards/&gt;.</p>
</section1>

<section1 topic='IQ-Based Publication and Retrieval' anchor='iq'>
  <p>As in <cite>XEP-0054</cite>, the primary method for publishing and retrieving vCards is the XMPP &IQ; stanza.</p>
  <section2 topic='Retrieval' anchor='iq-retrieval'>
    <p>An XMPP entity retrieves the vCard of another entity (or itself) by sending an IQ-get to the target entity containing a &lt;vcard/&gt; child element (note the lowercase "c"!) qualified by the 'urn:ietf:params:xml:ns:vcard-4.0' namespace.</p>
    <example caption="vCard Retrieval Request"><![CDATA[
<iq from='samizzi@cisco.com/foo'
    id='bx81v356'
    to='stpeter@jabber.org'
    type='get'>
  <vcard xmlns='urn:ietf:params:xml:ns:vcard-4.0'/>
</iq>
    ]]></example>
    <p>If a vCard exists for the target entity, the responsible entity (e.g., the XMPP server that hosts the account for a bare JID) MUST return the data in an IQ-result:</p>
    <example caption="Server Returns vCard"><![CDATA[
<iq from='stpeter@jabber.org'
    id='bx81v356'
    to='samizzi@cisco.com/foo'
    type='result'>
  <vcard xmlns="urn:ietf:params:xml:ns:vcard-4.0">
    <fn><text>Peter Saint-Andre</text></fn>
    <n><surname>Saint-Andre</surname><given>Peter</given><middle></middle></n>
    <nickname><text>stpeter</text></nickname>
    <nickname><text>psa</text></nickname>
    <photo><uri>http://me.stpeter.im/images/stpeter_oscon.jpg</uri></photo>
    <bday><date>1966-08-06</date></bday>
    <adr>
      <parameters><type><text>work</text></type></parameters>
      <ext>Suite 600</ext>
      <street>1899 Wynkoop Street</street>
      <locality>Denver</locality>
      <region>CO</region>
      <code>80202</code>
      <country>USA</country>
    </adr>
    <adr>
      <parameters><type><text>home</text></type></parameters>
      <ext></ext>
      <street></street>
      <locality>Denver</locality>
      <region>CO</region>
      <code>80210</code>
      <country>USA</country>
    </adr>
    <tel>
      <parameters><type><text>work</text><text>voice</text></type></parameters>
      <uri>tel:+1-303-308-3282</uri>
    </tel>
    <tel>
      <parameters><type><text>work</text><text>fax</text></type></parameters>
      <uri>tel:+1-303-308-3219</uri>
    </tel>
    <tel>
      <parameters><type><text>home</text><text>voice</text></type></parameters>
      <uri>tel:+1-303-555-1212</uri>
    </tel>
    <geo><uri>geo:39.59,-105.01</uri></geo>
    <title><text>Executive Director</text></title>
    <role><text>Patron Saint</text></role>
    <logo><uri>data:image/jpeg;
/9j/4AAQSkZJRgABAQEASABIAAD//gAXQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q/9sAQwAIBgYHBgUI
BwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy
/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy
MjIyMjIyMjIyMjIy/8AAEQgAgQB7AwEiAAIRAQMRAf/EABsAAAMAAwEBAAAAAAAAAAAAAAQFBgAD
BwIB/8QAPRAAAgEDAwIDBQQJBAEFAAAAAQIDAAQRBRIhMUEGE1EiYXGBkRQyobEHFSMzNEJScsEk
YtHw0jVDc8Lh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAQIEAwAF/8QAJBEAAgICAgICAgMAAAAAAAAA
AAECEQMhEjEEQSJREzJCYXH/2gAMAwEAAhEDEQA/AOf2c0KGSY2pDFiinYMsCMfhj8aya6gdvZj9
ryg6A8eYuORxQk1rdzSHyZGQYO0GXAPv/MV6luDp8QgntkRyhAfHJ3Y5wOoxxXncbdiA9zp/6xQG
KaGFIhK208MwX09amCOeMEdjT3VLi1EaeVGHEi4WRCQVwAD7PY5/CkQYbcfdPUVbjTS2FGAHGele
1nmXgOw6/iMV4LnHup/4c8L3/iWfbboIoFPt3D/dH/kfcKd0kOotukL/ALWs8SJNEPZGA4/z2omD
T7++dY7azuLlAOPs8Jfb9P8Amu1+Hv0Z+HtPjVp7YX846yXAyM+5elX1tDa2sKxwxRxoBgKigD6U
nJGn4a7OB+G/0Y67rlxuuIRptojDdcXS5c/2R9SfoPfXY/DvgzQvCiLJZW/m3uPavbgb5Sf9vZPl
9TVCBAw5RfiODQ93Fdi3b9XyxiXt5iE59wNPGSEnja6N5VyCzHYh5LOcUvuNc0y0JDTtO/8ATGP8
1Hahc6g87xX0ku9TyhbH4dKEA6AZx1prJ2n7KW58W3L5W1iS3H9XVsfGlMl3NdNvmld8/wBRoMHH
NbM5Hw5oAoIjALHPfA59O9KL218NS3byXtjE9w+GdivqBj8MUyk5ikAOPZ61rtreDUbaO5kiTeV2
HJ7r7P8AiuGSOXDyzBE1zlInAKFR6k9a+XFtHt8qWczjGVUKSAvPHu+VLftckzPu+62U2E5256Y7
1S+Fkj1DxPDaXEe5YYHldc9doGAfdnFQLE+VDdCc2ZXDaQDMTgFDEC6H175zgjimcv6PfFmvXMcy
6SttFtB8+4dIEIIz0PPfsKuE1O7tEMVoy2sfPs28Sxdev3Rmh5Jp52LyzSSnqS7E/nVkIcezrFlj
+ibSrC3aXWNbF9dAezaad93P+6Qjp8AKsNMt4LO1hgto0ihXhVj6CldrsSLoMt7qNhuiiDJyPSsc
k23Rfgi4qyphkCqAMcUQsue9TsGoAkDP1osXOT1oWO0x2JOeua2rPiki3GO/Hxr0L5F/nFGwNB2q
2UWq2+MAXCcxv/g/GopkaNijqVdWIYHqDVSt9uDYbt2pRrKrJJDdgcyrh/7h/wDlawlZLnh7QB96
E46ivSnlDXyAAyFD/Nx9elZGQ0XHJVsH3VqSntk3W7oDgEYz6ULbWkkURUuxO9ySOMksTRY5iPx5
o6KaMxKSygnkjFdQUzhMca3Mau7KXXII28EdvnVv4FtTLq97dOwLR2PlDHUEsD/ioO1uHCg9Og9B
mrPwXrENomp3EynYApYoMkYGOfRfaHuqeKansdlHOMTOeOSelaxjml763ayalcBplW22K8bnoCRl
gT3x2xW21v4bosoDIRgKHGGbPTjPpzWjkmhUrYbFNhgPSjLYPN7K45oGNRtDnGCCc+6grvxhDZsY
rS3LBeN/9VSvbPTi+KK6GwGBucg0T5HljqSPhXMz4/uFmAa1brzk4qisfFS3UIcMR6g9qL12FS5d
FasLOOMAV5ktMDIwamLjxVFagmWTC+g60HF+kOw85UzIfftoJphbrsqTKYwynI7VlzMJdP2fzKQw
+VDJqFjqsPmW0w8wclfWtYV3kKLzlSaeLakZ5acT6jhZIz0Vhj4HtXqQFLuTjaXGTitJztZSuGjY
EgjHuomQ7khlHpzVh5h8Gfs+e5oK6juvtDbCQuAQMj0FGkZgweo3D8DXiUxiTBYZAHYelKdRw85h
uPImyG3glT0z61WadpVteeCdQu4DKk8ZKFVwd53DHPUDDduDioieSYsryZIJ4JGSapvB2pG21CWz
iLSR3kZR0ZcYI6H48kUvH2zRjLTdOngh+23gSGOFdzPMvKgEg4Pr299btN8Qw3Es8kenwolxJgvs
BaMKPZOex+HrQXirWJdQu10m0kLwwkCUr0kk/wDFe3zo/wAP6KqxyW8hO5wWIHfHXFZSjS0beNXO
2Uk2bmyaKH75XaAPSpC48P3qysvnJEf5VPUiq/TzsYhSckkD4U4uNLtL61Czp7XZhwR8xWKu7LeK
emckk0a8VZGmkBYfcG7qaqvB+izSyMJh7O3INOx4bsrUmTy2kI6F2JApxo0ZWfftCx4xxTSbloEI
KPRz7xjp89veMsSkoOmKQR2N9bTKgtzJuI7HH1zXW9XsYrq4kWZCQ3Rh1FJk8LXayfsLobO3mJuo
xlx1QJwUttk3pDzwX8REEkTA9G6H1Hvq41Gznv8ASpoLMSCeZQIihwwbIPB7Vvh0j7PEPtDeY3rj
AHw9KUa3c3EVmY7aXy3LfeHXHGefnSOTsbhy+Jmm61JLdHS9e/02oqTHHdNgJKf6X9D6HpTpoJYk
aF125JIB6qf+4qXk0/8AWFnHJMfM8yMNyevFEaVq11psiWWozNLZniK4ckmP0Uk9vf2quLdbPKmq
k0ig3AxZyOWP1IoG5jZp2IYYwPyo+RCigEdwR7/nXxolJ+5TMCOMy6cjloldDclDtjZcBh2KnOAe
vFePCysNZkQTpbSG3lAkk6Icfn2oW3t7iBnTIwcYB7ntjPz+lPI41jucxxtPPHCHaRkUjOBk+hx+
NYObho1SbDNGh0+3id/MJkAOd45Pfj6U6s7t0j0yWYCMzxud3Ze+KWX7Lc2lr5YjMqIY9yLgMg4y
Pfk0PqazRaXpiSlxuQuAw6ZAroNysWMqdlIbhYH3owK9VPrX1vEwgXJcYHqaTpMG0+DJziNRSe9A
julMn7vbuHxrDjuj0Yz1ZTxa8sjm9v8AzvsiA+yvUntTSw8b6TtKx7gOwNRL3cU1qIzcqM44z0pQ
+lTtlrWWJjnJAcA08YJPsDyy9I68fE2jX0ixy3Pkk9Gz3oLT/FC+e9vM6syMVV+mR2rnFnpNxHNG
8rIWzk5YGnht0lkySEkHcd6E1T0Osl9o6C2qpcIVGDxSHxBMsPh+5lI/anEafE9/oKVafLLFNtkP
TofWvPiu9zZw2QHL/tSfdyB+dGHykLmdQbQfeuNP0G2uIQS0fkjJ/m4yR+BpmY7a7tY5gQ8cyhlB
HUHtSfxJIX0FdoCwxvGqD19k148H3u+Oe1lbLRANCPicED5mrKPLbKDTHNl/o7pZJbM8xsCd0R9P
7fT3+6mhuIFJUTK2OMqQB+Nabc+Vew7sja+XI6+8VN+JpLS08R3sC20MgRgC2M87RkfI8fKhdHUR
Eqs826JiFJ3GJicNj8q1K7QasY4lUJuwgDHA+Jr5qGoFZFEC7QVwccU80S7tbjUYIjGrsrsqtJgA
nBOPxFScZcv6NZP6FzxvFAIyCu1SQAeSCe3zzTXWJpr2y0uNUy8MGXbcAOQMc/KtfiGAx6rHBCQx
8sbQPUscCvfimHz9G8uEYFsqkheAdowf+flVeHC6bMWwG3nVQYDIrFeMq2QOeK3TbJgsUqBjnFLv
Clmt1aaizrgewFYDocmi/NZHCsAJAcEGpsiuWi/G6jsMHh61juRcxoGV12tG3TPrTP8AVOnMuJNO
lRiwO5FJzwO4rxA7m2U7chhjFDy6heWr/swwHcE8Ckv7N0os3X/h+0kikksoJo2z7O4lfzpRHpN5
YzxedcGVmzuH9NUFpfvOp3qzMemelBajMzXMa59r1rm/SOcUj2zYdWX04+NKNbnNzePtIOxAg+PJ
/wA0RdXQhAVTlvypNLMMMzHJ3At9a2wQp2SeRk1xRaeLNsWi2sCHOJUUn4IRU/o119j1uynJOBLh
h6huP8088Uc6Qsz8Ga4Gz3AKT/kVIGTE8RHUOCPqKoSJDqqkhsknJIOflSZ7qzhkZL1Fe53EuxQ8
55/Iinb/AL/AHG4/8U0g01Lm2ilJiJZFzkDPAxQCcCuxslL+YoYnbjOeMVQeFjeR7GjtBcYlLKCv
IOBk5xxkVXw6L4fsmDRWMMsi8B5zvP0PFbri+mCCKJkRcYAXgYrePhv+TOc/oU6rpkz6p9ufbCuw
KsZbLKff9aC3tgq+DgFT3B7UyklySrcE5z76AmAwW2nGOearhj4RpGVtnrTjFBD9liQIgXgD/vNK
tbtnBM0XDDHzFbfPMUgdTlaMd0uYd4OfdXleRheOfJdHoY8inCn2A6TrChtrH7uMBj0p3JrFtMVQ
RqSSecdTUff2qpMWT2eeooSKS4jcMrZI6ZrHgnsP5GtF7cXsKo7sAm3sOKQrc+bcTTM37GH2nk9M
8AUHBHLecXEh2HqF71v19o7Lw+IIgFEsiqR7hz/ihGK5DSk3GwW7Dw3UyOcurHn8vwrVbWzXtzDB
082RUJ9Mmmtvo11rumW1/aNGZBGI5InbaxK8ZHr2r5Z2k1rrVjbSxvE5uEB3jbgZ5q9xa/wgu2OP
HE4k+xIh/ZoZAMd8bakl5ljb1I/MVTeNCpWw8v7oMqjj4c/WphWwV5xyDSJ6CdYdv9Vnk4c1SWlq
4tYwsgC44GKmCf2z9gGz3qxsJozYQFm5KA/WlOOXyXmV3LbuBjqFOKG86VwSu3gdCc0El/Pavtcs
wHGCc0aJBcJ5ls6h+pU165mCudxGXYtnOOgFCzXgSJgxCRgd+rGjmkimO2T9nIOMilV/aOmWOGjJ
/wCmhK60cgAXOx/bJIY1vWeSBtybnU9QBS2aNIs7nJ9MCt1ndMDsyfQZPU9qmbT+Mh1raDpl+0Dc
o+tBeQ6ScJkVkd5JNqYt7OMyqAd2Ty3rj4UwhxOqyRZKn6j3GoMmNReiqMuW2b7RHwCRilviaQyf
Y4V5wxOPU04x5ERZuTj6UhvdUtoL3eEFxMowP6F9ce+kxQVhySqNIrtDjks9DSJWG3GWVutM7e4h
ljXzHDqP5ZBnHw7ilFrL5yQOmfLZAw+fNN7e3jVi7DrXs0qoha2aNV0uDUokEMqxSIxIDHIbIHHu
qQvrK5sJRHPEVcA4PZvgasb28gXIVFDD+YcZoIzG/ga2uYjLG3C46qT3rGeFVaOTKQXDNKwlOT0y
F93f51To5ihiQZAWJB0/2ipRgWiaQnLsNicDjA6mqaa1DuG2/wAqjqewAqFpp0zRHKNR/eCtel/x
ArKyvVZmEah+9Wvp/gz8Kyspl0cIZ/3bUvi6r/dWVlSZOx4maF/6wvz/ADNOtB/eXf8A8jVlZUcz
aPYXq38EfnUbcfxXyFZWUMQch0LTP4SH+2nX/sn4VlZXqx/VEz7EF19/50bpf8SPgPzrKyuAO4P3
0vx/+oqw7D4D8qysrzcv7jro/9k=
      </uri>
    </logo>
    <org>
      <parameters><type><text>work</text></type></parameters>
      <text>XMPP Standards Foundation</text>
    </org>
    <url><uri>https://stpeter.im/</uri></url>
    <url><uri>http://www.saint-andre.com/</uri></url>
    <key>
      <text>
-----BEGIN PGP PUBLIC KEY BLOCK-----

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
=4sgL
-----END PGP PUBLIC KEY BLOCK-----
      </text>
    </key>
    <note>
      <text>
      More information about me is located on my 
      personal website: https://stpeter.im/
      </text>
    </note>
    <gender><sex><text>M</text></sex></gender>
    <lang>
      <parameters><pref>1</pref></parameters>
      <language-tag>en</language-tag>
    </lang>
    <email>
      <parameters><type><text>work</text></type></parameters>
      <text>psaintan@cisco.com</text>
    </email>
    <email>
      <parameters><type><text>home</text></type></parameters>
      <text>stpeter@jabber.org</text>
    </email>
    <impp>
      <parameters><type><text>home</text></type></parameters>
      <uri>xmpp:psaintan@cisco.com</uri>
    </impp>
    <impp>
      <parameters><type><text>home</text></type></parameters>
      <uri>xmpp:stpeter@jabber.org</uri>
    </impp>
    <key>
      <parameters><type><text>work</text></type></parameters>
      <uri>https://stpeter.im/index.php/contact/</uri>
    </key>
  </vcard>
</iq>
    ]]></example>
    <p>If no vCard exists, the server MUST return an IQ-result containing an empty &lt;vcard/&gt; element.</p>
    <example caption="No vCard (empty element)"><![CDATA[
<iq from='stpeter@jabber.org'
    id='bx81v356'
    to='samizzi@cisco.com/foo'
    type='result'>
  <vcard xmlns='urn:ietf:params:xml:ns:vcard-4.0'/>
</iq>
    ]]></example>
  </section2>
  <section2 topic='Publication' anchor='iq-publication'>
    <p>An XMPP entity publishes or updates its vCard by sending an IQ-set to itself, containing a &lt;vcard/&gt; child element qualified by the 'urn:ietf:params:xml:ns:vcard-4.0' namespace.</p>
    <example caption="vCard Publication Request"><![CDATA[
<iq from='stpeter@jabber.org/squire
    id='h3vz319m'
    to='stpeter@jabber.org'
    type='set'>
  <vcard xmlns='urn:ietf:params:xml:ns:vcard-4.0'>
    [...]
  </vcard>
</iq>
    ]]></example>
    <p>If no error occurs, the responsible entity returns an IQ-result.</p>
    <example caption="Server Acknowledges Publication"><![CDATA[
<iq from='stpeter@jabber.org'
    id='bx81v356'
    to='stpeter@jabber.org/squire'
    type='result'/>
    ]]></example>
    <p>Note: An entity MAY have authorization to update the vCard of another entity (e.g., a server administrator might have authorization to modify the server's vCard).</p>
  </section2>
</section1>

<section1 topic='Event Notifications' anchor='pep'>
  <p>&xep0060; provides a way to subscribe to events, and &xep0163; defines a pubsub profile for events associated with instant messaging (IM) accounts. If PEP is supported by an IM server, it can be used to automatically generate event notifications when a user's vCard is modified.</p>
  <section2 topic='Location' anchor='pubsub-location'>
    <p>The canonical location for notifications regarding a user's vCard is a pubsub node whose name is "urn:xmpp:vcard4".</p>
  </section2>
  <section2 topic='Subscribing to vCard Notifications' anchor='pubsub-subscribe'>
    <p>Let us imagine that Juliet wishes to receive the updates that Romeo publishes to his vCard. She has two options:
    <ol>
      <li>Implicitly subscribe by advertising support for "urn:xmpp:vcard4+notify" in her &xep0115; data. Romeo's PEP service then automatically sends vCard updates to her when it receives presence from her, until and unless she sends presence of type unavailable or stops advertising an interest in vCard updates. This is in accordance with XEP-0060, section 6.1.</li>
      <li>Explicitly subscribe by sending a formal subscription request to the "urn:xmpp:vcard4" node at Romeo's JabberID. Romeo's PEP service may send her all vCard updates even if she is offline at the time (depending on service policies regarding presence integration).</li>
    </ol>
  </p>
  </section2>
  <section2 topic='Receiving a vCard Notification'>
    <p>Because Juliet has sent presence to Romeo including Entity Capabilities data that includes the "urn:xmpp:vcard4+notify" feature, Romeo's XMPP server will send a PEP notification to Juliet. The notification can include an XMPP message body for backwards-compatibility with XMPP clients that are not pubsub-capable (see Message Body). This is in accordance with XEP-0060, second 6.1.7.</p>
    <example caption="Receiving a vCard publication/update"><![CDATA[
<message from='romeo@montague.lit'
         to='juliet@capulet.lit'
         type='headline'>
  <event xmlns='http://jabber.org/protocol/pubsub#event'>
    <items node='urn:xmpp:vcard4'>
      <item id='current'/>
    </items>
  </event>
</message>
    ]]></example>
    <p>Note: There is no payload, because this is a pure notification (the receiver needs to retrieve the vCard using an IQ-get as described earlier..</p>
  </section2>
</section1>

<section1 topic='vCards of Automated Entities' anchor='things'>
  <p>Traditionally, vCards have been used on the XMPP network for entities other than human users, e.g. by XMPP servers and chatrooms. When such automated entities use vCards, it is RECOMMENDED to specify a value of "thing" for the vCard4 KIND property &vcardthing;. An example follows.</p>
  <example caption="vCard for a Thing"><![CDATA[
<iq from='jabber.org'
    id='yhx51c35'
    to='samizzi@cisco.com/foo'
    type='result'>
  <vcard xmlns='urn:ietf:params:xml:ns:vcard-4.0'>
    <fn><text>jabber.org IM service</text></fn>
    <url><uri>http://www.jabber.org/</uri></url>
    <lang>
      <parameters><pref>1</pref></parameters>
      <language-tag>en</language-tag>
    </lang>
    <email><text>xmpp@jabber.org</text></email>
    <impp><uri>xmpp:jabber.org</uri></impp>
    <logo><uri>http://www.jabber.org/images/logo.png</uri></logo>
    <geo><uri>geo:42.25,-91.05</uri></geo>
    <tz><text>America/Chicago</text></tz>
    <kind><text>thing</text></kind>
  </vcard>
</iq>
    ]]></example>
</section1>

<section1 topic='Security Considerations' anchor='security'>
  <p>The vCard information published to one's XMPP server is world-readable; therefore, users should exercise due caution when determining what information to include (e.g., street addresses, personal telephone numbers, or email addresses).</p>
</section1>

<section1 topic='IANA Considerations' anchor='iana'>
  <p>This document does not require interaction with &IANA;.</p>
</section1>

<section1 topic='Mapping from vcard-temp to vCard4' anchor='mapping'>
  <p>This section provides a more detailed description of mapping vcard-temp properties to vcard4 properties.</p>
  <section2 topic='Properties Defined in vcard-temp but not in vCard3 or vCard4' anchor='mapping-temponly'>
    <section3 topic='DESC' anchor='mapping-temponly-desc'>
      <p>The vcard-temp specification defined a &lt;DESC/&gt; element. This element was not part of the vCard3 schema. Mapping the vcard-temp &lt;DESC/&gt; element to the vCard4 NOTE property is appropriate.</p>
      <example caption="Deprecated DESC element"><![CDATA[
<DESC>
   More information about me is located on my 
   personal website: https://stpeter.im/
</DESC>
      ]]></example>
      <example caption="NOTE property"><![CDATA[
<note>
  <text>
     More information about me is located on my 
     personal website: https://stpeter.im/
  </text>
</note>
      ]]></example>
    </section3>
    <section3 topic='JABBERID' anchor='mapping-temponly-jabberid'>
      <p>The vcard-temp specification defined a &lt;JABBERID/&gt; element:</p>
      <example caption="Deprecated JABBERID element"><![CDATA[
<JABBERID>stpeter@jabber.org</JABBERID>
      ]]></example>
      <p>Although the JABBERID field was not part of the vCard3 schema and was simply hacked into vcard-temp, &rfc4770; defined an IMPP property for instant messaging and presence addresses, which was ported to vCard4. In the vCard4 XML format, the IMPP property for a JabberID would be as follows.</p>
      <example caption="IMPP property"><![CDATA[
<impp>
  <uri>xmpp:stpeter@jabber.org</uri>
</impp>
      ]]></example>
    </section3>
  </section2>
  <section2 topic='Properties Defined Incorrectly in vcard-temp' anchor='mapping-incorrect'>
    <p>Several of the properties in vcard-temp are defined differently in vCard3. In fact, the definitions even differ from those provisionally made in the so-called "Dawson drafts" from which vcard-temp was supposedly defined (for reference, the last of these is archived at &lt;<link url='http://www.watersprings.org/pub/id/draft-dawson-vcard-xml-dtd-03.txt'>http://www.watersprings.org/pub/id/draft-dawson-vcard-xml-dtd-03.txt</link>&gt;). The reasons for these discrepancies are unknown. However, care must be taken in correctly mapping these properties from vcard-temp to vCard4.</p>
    <section3 topic='KEY' anchor='mapping-incorrect-key'>
      <p>The DTD in <cite>XEP-0054</cite> provided this definition for the KEY element:</p>
      <code><![CDATA[
<!ELEMENT KEY (TYPE?, CRED)>
      ]]></code>
      <p>However, the DTD in the final Dawson draft provided the following definition:</p>
      <code><![CDATA[
<!ELEMENT key (extref | b64bin)>
      ]]></code>
      <p>The relevant RelaxNG definition in vCard4 XML is as follows:</p>
      <code><![CDATA[
property-key = element key {
    (value-uri | value-text)
  }
      ]]></code>
      <p>The source of the spurious &lt;TYPE/&gt; and &lt;CRED/&gt; elements is unknown. Here we map the vcard-temp &lt;CRED/&gt; element to the vCard4 value-text construction.</p>
    </section3>
    <section3 topic='SOUND' anchor='mapping-incorrect-sound'>
      <p>The DTD in <cite>XEP-0054</cite> provided this definition for the SOUND element:</p>
      <code><![CDATA[
<!ELEMENT SOUND (PHONETIC | BINVAL | EXTVAL)>
      ]]></code>
      <p>However, the DTD in the final Dawson draft provided the following definition:</p>
      <code><![CDATA[
<!ELEMENT sound (extref | b64bin)>
      ]]></code>
      <p>The source of the spurious &lt;PHONETIC/&gt; element is unknown. However, it does not exist in vCard4 and therefore is simply discarded when mapping.</p>
    </section3>
  </section2>
  <section2 topic='Properties Defined Differently in vcard-temp, vCard3, and vCard4' anchor='mapping-different'>
    <p>The following properties are defined differently in vcard-temp and vCard4. As a result, the mappings are workable but might not preserve all information that could have been contained in vcard-temp data.</p>
    <section3 topic='ADR' anchor='mapping-different-adr'>
      <p>The following address type values allowed in vCard3 were removed from vCard4:</p>
      <ul>
        <li>DOM</li>
        <li>INTL</li>
        <li>PARCEL</li>
        <li>POSTAL</li>
      </ul>
    </section3>
    <section3 topic='AGENT' anchor='mapping-different-agent'>
      <p>In vCard3 and vcard-temp, the AGENT property was allowed to contain inline vCard of someone who could act as an agent for the primary owner of the referenced vCard. In vCard4, inline vCards are disallowed. Therefore only pointers to external vCard objects are now allowed, by means of a URI.</p>
    </section3>
    <section3 topic='ORG' anchor='mapping-different-org'>
      <p>The ORGUNIT property was removed from vCard4, with the result that the ORGNAME property becomes the only value for an ORG.</p>
    </section3>
    <section3 topic='SORT-STRING' anchor='mapping-different-sortstring'>
      <p>The SORT-STRING property from vCard3 was renamed to SORT-AS in vCard4.</p>
    </section3>
    <section3 topic='TEL' anchor='mapping-different-tel'>
      <p>The following telephony type values allowed in vCard3 were removed from vCard4:</p>
      <ul>
        <li>BBS</li>
        <li>ISDN</li>
        <li>MODEM</li>
        <li>MSG</li>
        <li>PCS</li>
      </ul>
      <p>In addition, in vCard4 the telephone number is represented as a tel: URI, not by means of a NUMBER property.</p>
    </section3>
  </section2>
  <section2 topic='Properties Defined Similarly in vcard-temp, vCard3, and vCard4' anchor='mapping-similar'>
    <p>The following properties are defined similarly in vcard-temp, vCard3, and vCard4, and the mappings are fairly straightforward (a future version of this document might provide more detailed narrative descriptions of the mappings).</p>
    <ul>
      <li>BDAY</li>
      <li>CATEGORIES</li>
      <li>EMAIL</li>
      <li>FN</li>
      <li>GEO</li>
      <li>LOGO</li>
      <li>N</li>
      <li>NICKNAME</li>
      <li>NOTE</li>
      <li>PHOTO</li>
      <li>PRODID</li>
      <li>REV</li>
      <li>ROLE</li>
      <li>TITLE</li>
      <li>UID</li>
      <li>URL</li>
    </ul>
  </section2>
  <section2 topic='Properties Defined in vCard3 but Removed from vCard4' anchor='mapping-removed'>
    <p>The following properties were defined in vCard3 but were removed from vCard4:</p>
    <ul>
      <li>CLASS</li>
      <li>LABEL</li>
      <li>MAILER</li>
    </ul>
    <p>There is no mapping from these properties to vCard4.</p>
  </section2>
</section1>
<section1 topic='Extensible Stylesheet Language Transformation (XSLT) from vcard-temp to vCard4' anchor='xslt'>
  <p>This section provides a <strong>highly provisional and purely informational</strong> XSLT script for migration from vcard-temp to vCard4.</p>
    <code><![CDATA[
<?xml version='1.0' encoding='UTF-8'?>

<!--

Copyright (c) 1999 - 2011 XMPP Standards Foundation

Permission is hereby granted, free of charge, to any 
person obtaining a copy of this software and 
associated documentation files (the "Software"), to 
deal in the Software without restriction, including 
without limitation the rights to use, copy, modify, 
merge, publish, distribute, sublicense, and/or sell 
copies of the Software, and to permit persons to whom 
the Software is furnished to do so, subject to the 
following conditions:

The above copyright notice and this permission notice 
shall be included in all copies or substantial portions 
of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF 
ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED 
TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT 
SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR 
ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN 
ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE 
OR OTHER DEALINGS IN THE SOFTWARE.

-->

<!-- Author: stpeter@jabber.org -->

<!-- Version: 0.0.1 -->

<!-- Last Updated: 2011-06-20 -->

<!-- NOTE: This is a provisional mapping with known
     errors. It is subject to change without notice.
     Please use this only for experimental purposes!
     You have been warned!! -->

<xsl:stylesheet 
     xmlns='urn:ietf:params:xml:ns:vcard-4.0' 
     xmlns:xsl='http://www.w3.org/1999/XSL/Transform' 
     version='1.0'>

  <xsl:output method='xml'/>

  <xsl:template match='/'>
    <vcard>

      <!-- BEGIN VARIABLES -->

      <!-- in case we need them, count instances of the vcard-temp 
           elements per the DTD in XEP-0054 -->

      <xsl:variable name='FN.count' select='count(/vCard/FN)'/>
      <xsl:variable name='N.count' select='count(/vCard/N)'/>
      <xsl:variable name='NICKNAME.count' select='count(/vCard/NICKNAME)'/>
      <xsl:variable name='PHOTO.count' select='count(/vCard/PHOTO)'/>
      <xsl:variable name='BDAY.count' select='count(/vCard/BDAY)'/>
      <xsl:variable name='ADR.count' select='count(/vCard/ADR)'/>
      <xsl:variable name='LABEL.count' select='count(/vCard/LABEL)'/>
      <xsl:variable name='TEL.count' select='count(/vCard/TEL)'/>
      <xsl:variable name='EMAIL.count' select='count(/vCard/EMAIL)'/>
      <xsl:variable name='JABBERID.count' select='count(/vCard/JABBERID)'/>
      <xsl:variable name='MAILER.count' select='count(/vCard/MAILER)'/>
      <xsl:variable name='TZ.count' select='count(/vCard/TZ)'/>
      <xsl:variable name='GEO.count' select='count(/vCard/GEO)'/>
      <xsl:variable name='TITLE.count' select='count(/vCard/TITLE)'/>
      <xsl:variable name='ROLE.count' select='count(/vCard/ROLE)'/>
      <xsl:variable name='LOGO.count' select='count(/vCard/LOGO)'/>
      <xsl:variable name='AGENT.count' select='count(/vCard/AGENT)'/>
      <xsl:variable name='ORG.count' select='count(/vCard/ORG)'/>
      <xsl:variable name='CATEGORIES.count' select='count(/vCard/CATEGORIES)'/>
      <xsl:variable name='NOTE.count' select='count(/vCard/NOTE)'/>
      <xsl:variable name='PRODID.count' select='count(/vCard/PRODID)'/>
      <xsl:variable name='REV.count' select='count(/vCard/REV)'/>
      <xsl:variable name='SORT-STRING.count' select='count(/vCard/SORT-STRING)'/>
      <xsl:variable name='SOUND.count' select='count(/vCard/SOUND)'/>
      <xsl:variable name='UID.count' select='count(/vCard/UID)'/>
      <xsl:variable name='URL.count' select='count(/vCard/URL)'/>
      <xsl:variable name='CLASS.count' select='count(/vCard/CLASS)'/>
      <xsl:variable name='KEY.count' select='count(/vCard/KEY)'/>
      <xsl:variable name='DESC.count' select='count(/vCard/DESC)'/>

      <!-- END VARIABLES -->

      <!-- BEGIN VCARD4 OUTPUT -->

      <!-- FN is required -->

      <fn><text><xsl:value-of select='/vCard/FN'/></text></fn>

      <!-- N is required -->

      <xsl:apply-templates select='/vCard/N'/>

      <!-- NICKNAME can be included one or more times -->

      <xsl:for-each select='/vCard/NICKNAME'>
        <nickname><text><xsl:value-of select='.'/></text></nickname>
      </xsl:for-each>

      <!-- PHOTO can be included one or more times -->
      <!-- content is either a pointer to a URL or inline binary,
           which is mapped to a data: URI in vCard4 -->

      <xsl:for-each select='/vCard/PHOTO'>
        <xsl:variable name='PHOTO.ext' select='count(EXTVAL)'/>
        <xsl:variable name='PHOTO.type' select='TYPE'/>
        <xsl:choose>
          <xsl:when test='$PHOTO.ext=1'>
            <photo><uri><xsl:value-of select='EXTVAL'/></uri></photo>
          </xsl:when>
          <xsl:otherwise>
            <photo>
              <uri>
                <xsl:text>data:</xsl:text><xsl:value-of select='TYPE'/><xsl:text>;</xsl:text><xsl:value-of select='BINVAL'/>
              </uri>
            </photo>
          </xsl:otherwise>
        </xsl:choose>
      </xsl:for-each>

      <!-- BDAY can be included once -->

      <xsl:if test='$BDAY.count=1'>
        <bday><date><xsl:value-of select='/vCard/BDAY'/></date></bday>
      </xsl:if>

      <!-- ADR can be included one or more times -->

      <xsl:apply-templates select='/vCard/ADR'/>

      <!-- NOTE: vcard-temp allowed a LABEL element, 
           but it was removed from vCard4 -->

      <!-- one or more TEL elements can be included -->

      <!-- FIXME -->

      <xsl:apply-templates select='/vCard/TEL'/>

      <!-- one or more EMAIL elements can be included -->

      <xsl:apply-templates select='/vCard/EMAIL'/>

      <!-- JABBERID can be included one or more times -->
      <!-- we map this to the vCard4 IMPP property -->

      <xsl:for-each select='/vCard/JABBERID'>
        <impp><uri><xsl:text>xmpp:</xsl:text><xsl:value-of select='.'/></uri></impp>
      </xsl:for-each>

      <!-- NOTE: vcard-temp allowed a MAILER element, 
           but it was removed from vCard4 -->

      <!-- one or more TZ elements can be included -->

      <xsl:for-each select='/vCard/TZ'>
        <tz><text><xsl:value-of select='.'/></text></tz>
      </xsl:for-each>

      <!-- one or more GEO elements can be included -->

      <xsl:for-each select='/vCard/GEO'>
        <geo>
          <uri>
            <xsl:text>geo:</xsl:text><xsl:value-of select='LAT'/><xsl:text>,</xsl:text><xsl:value-of select='LON'/>
          </uri>
        </geo>
      </xsl:for-each>

      <!-- one or more TITLE elements can be included -->

      <xsl:for-each select='/vCard/TITLE'>
        <title><text><xsl:value-of select='.'/></text></title>
      </xsl:for-each>

      <!-- one or more ROLE elements can be included -->

      <xsl:for-each select='/vCard/ROLE'>
        <role><text><xsl:value-of select='.'/></text></role>
      </xsl:for-each>

      <!-- one or more LOGO elements can be included -->
      <!-- content is either a pointer to a URL or inline binary,
           which is mapped to a data: URI in vCard4 -->

      <xsl:for-each select='/vCard/LOGO'>
        <xsl:variable name='LOGO.ext' select='count(EXTVAL)'/>
        <xsl:variable name='LOGO.type' select='TYPE'/>
        <xsl:choose>
          <xsl:when test='$LOGO.ext=1'>
            <logo><uri><xsl:value-of select='EXTVAL'/></uri></logo>
          </xsl:when>
          <xsl:otherwise>
            <logo>
              <uri>
                <xsl:text>data:</xsl:text><xsl:value-of select='TYPE'/><xsl:text>;</xsl:text><xsl:value-of select='BINVAL'/>
              </uri>
            </logo>
          </xsl:otherwise>
        </xsl:choose>
      </xsl:for-each>

      <!-- one or more AGENT elements can be included -->
      <!-- however, inline vcards are not supported in vCard4 -->
      <!-- the relevant vCard4 property is RELATED -->
      <!-- only EXTVAL is supported now via URIs -->
      <!-- NOTE: this element was probably unused in vcard-temp -->

      <xsl:for-each select='/vCard/AGENT'>
        <xsl:variable name='AGENT.ext' select='count(EXTVAL)'/>
        <xsl:if test='$AGENT.ext=1'>
          <agent><uri><xsl:value-of select='EXTVAL'/></uri></agent>
        </xsl:if>
      </xsl:for-each>

      <!-- one or more ORG elements can be included -->
      <!-- NOTE: ORGUNIT is no longer used in vcard4 -->

      <xsl:for-each select='/vCard/ORG'>
        <org>
          <xsl:variable name='ORGNAME.count' select='count(ORGNAME)'/>
          <xsl:if test='$ORGNAME.count=1'>
            <text><xsl:value-of select='ORGNAME'/></text>
          </xsl:if>
        </org>
      </xsl:for-each>

      <!-- one or more CATEGORIES elements can be included -->
      <!-- NOTE: this element was probably unused in vcard-temp -->

      <xsl:for-each select='/vCard/CATEGORIES'>
        <categories><text><xsl:value-of select='.'/></text></categories>
      </xsl:for-each>

      <!-- one or more NOTE elements can be included -->
      <!-- NOTE: this element was probably unused in vcard-temp -->

      <xsl:for-each select='/vCard/NOTE'>
        <note><text><xsl:value-of select='.'/></text></note>
      </xsl:for-each>

      <!-- PRODID can be included exactly once -->
      <!-- NOTE: this element was probably unused in vcard-temp -->

      <xsl:if test='$PRODID.count=1'>
        <prodid><text><xsl:value-of select='.'/></text></prodid>
      </xsl:if>

      <!-- REV can be included exactly once -->
      <!-- NOTE: this element was probably unused in vcard-temp -->

      <xsl:if test='$REV.count=1'>
        <rev><timestamp><xsl:value-of select='.'/></timestamp></rev>
      </xsl:if>

      <!-- one or more SORT-STRING elements can be included -->
      <!-- this element maps to SORT-AS in vCard4 -->

      <xsl:for-each select='/vCard/SORT-STRING'>
        <sort-as><xsl:value-of select='.'/></sort-as>
      </xsl:for-each>

      <!-- one or more SOUND elements can be included -->
      <!-- NOTE: for some reason, vcard-temp allowed a <PHONETIC/>
           child element, but that was not documented in the
           original Dawson I-Ds and is not supported in vCard4 -->

      <xsl:for-each select='/vCard/SOUND'>
        <xsl:variable name='SOUND.ext' select='count(EXTVAL)'/>
        <xsl:variable name='SOUND.bin' select='count(BINVAL)'/>
        <xsl:choose>
          <xsl:when test='$SOUND.ext=1'>
            <sound><uri><xsl:value-of select='EXTVAL'/></uri></sound>
          </xsl:when>
          <xsl:when test='$SOUND.ext=1'>
            <sound>
              <uri>
                <xsl:text>data:audio/basic;base64,</xsl:text><xsl:value-of select='BINVAL'/>
              </uri>
            </sound>
          </xsl:when>
          <xsl:otherwise>
          </xsl:otherwise>
        </xsl:choose>
      </xsl:for-each>

      <!-- UID can be included exactly once -->

      <xsl:if test='$UID.count=1'>
        <uid><uri><xsl:value-of select='/vCard/UID'/></uri></uid>
      </xsl:if>

      <!-- URL can be included one or more times -->

      <xsl:for-each select='/vCard/URL'>
        <url><uri><xsl:value-of select='.'/></uri></url>
      </xsl:for-each>

      <!-- NOTE: vcard-temp allowed a CLASS element, 
           but it was removed from vCard4 -->

      <!-- KEY can be included one or more times -->

      <xsl:for-each select='/vCard/KEY'>
        <key><text><xsl:value-of select='CRED'/></text></key>
      </xsl:for-each>

      <!-- DESC can be included one or more times -->
      <!-- this existed in vcard-temp but not vCard3 -->
      <!-- mapped to the NOTE element -->

      <xsl:for-each select='/vCard/DESC'>
        <note><text><xsl:value-of select='.'/></text></note>
      </xsl:for-each>

    </vcard>

  </xsl:template>

  <xsl:template match='N'>
    <n>
      <xsl:variable name='FAMILY.count' select='count(FAMILY)'/>
      <xsl:variable name='GIVEN.count' select='count(GIVEN)'/>
      <xsl:variable name='MIDDLE.count' select='count(MIDDLE)'/>
      <xsl:variable name='PREFIX.count' select='count(PREFIX)'/>
      <xsl:variable name='SUFFIX.count' select='count(SUFFIX)'/>
      <xsl:if test='$FAMILY.count=1'>
        <surname><xsl:value-of select='FAMILY'/></surname>
      </xsl:if>
      <xsl:if test='$GIVEN.count=1'>
        <given><xsl:value-of select='GIVEN'/></given>
      </xsl:if>
      <xsl:if test='$MIDDLE.count=1'>
        <middle><xsl:value-of select='MIDDLE'/></middle>
      </xsl:if>
      <xsl:if test='$PREFIX.count=1'>
        <prefix><xsl:value-of select='PREFIX'/></prefix>
      </xsl:if>
      <xsl:if test='$SUFFIX.count=1'>
        <suffix><xsl:value-of select='SUFFIX'/></suffix>
      </xsl:if>
    </n>
  </xsl:template>

  <xsl:template match='ADR'>
    <adr>
      <xsl:variable name='HOME.count' select='count(HOME)'/>
      <xsl:variable name='WORK.count' select='count(WORK)'/>
      <!-- NOTE: vcard-temp allowed address types of POSTAL, PARCEL,
           DOM, and INTL, but they were removed from vCard4 -->
      <xsl:variable name='PREF.count' select='count(PREF)'/>
      <xsl:variable name='POBOX.count' select='count(POBOX)'/>
      <xsl:variable name='EXTADD.count' select='count(EXTADD)'/>
      <xsl:variable name='STREET.count' select='count(STREET)'/>
      <xsl:variable name='LOCALITY.count' select='count(LOCALITY)'/>
      <xsl:variable name='REGION.count' select='count(REGION)'/>
      <xsl:variable name='PCODE.count' select='count(PCODE)'/>
      <!-- NOTE: yes, vcard-temp has CTRY, not COUNTRY -->
      <xsl:variable name='CTRY.count' select='count(CTRY)'/>
      <xsl:if test='$HOME.count=1'>
        <parameters><type><text>home</text></type></parameters>
      </xsl:if>
      <xsl:if test='$WORK.count=1'>
        <parameters><type><text>work</text></type></parameters>
      </xsl:if>
      <xsl:if test='$PREF.count=1'>
        <parameters><pref><integer>1</integer></pref></parameters>
      </xsl:if>
      <xsl:if test='$POBOX.count=1'>
        <pobox><xsl:value-of select='POBOX'/></pobox>
      </xsl:if>
      <xsl:if test='$EXTADD.count=1'>
        <ext><xsl:value-of select='EXTADD'/></ext>
      </xsl:if>
      <xsl:if test='$STREET.count=1'>
        <street><xsl:value-of select='STREET'/></street>
      </xsl:if>
      <xsl:if test='$LOCALITY.count=1'>
        <locality><xsl:value-of select='LOCALITY'/></locality>
      </xsl:if>
      <xsl:if test='$REGION.count=1'>
        <region><xsl:value-of select='REGION'/></region>
      </xsl:if>
      <xsl:if test='$PCODE.count=1'>
        <code><xsl:value-of select='PCODE'/></code>
      </xsl:if>
      <xsl:if test='$CTRY.count=1'>
        <country><xsl:value-of select='CTRY'/></country>
      </xsl:if>
    </adr>
  </xsl:template>

  <xsl:template match='TEL'>
    <tel>
      <xsl:variable name='HOME.count' select='count(HOME)'/>
      <xsl:variable name='WORK.count' select='count(WORK)'/>
      <xsl:variable name='TEXT.count' select='count(TEXT)'/>
      <xsl:variable name='VOICE.count' select='count(VOICE)'/>
      <xsl:variable name='FAX.count' select='count(FAX)'/>
      <xsl:variable name='CELL.count' select='count(CELL)'/>
      <xsl:variable name='VIDEO.count' select='count(VIDEO)'/>
      <xsl:variable name='PAGER.count' select='count(PAGER)'/>
      <xsl:variable name='TEXTPHONE.count' select='count(TEXTPHONE)'/>
      <!-- NOTE: vcard-temp allowed telephony types of MSG, BBS,
           MODEM, ISDN, and PCS but they were removed from vCard4 -->
      <xsl:variable name='NUMBER.count' select='count(NUMBER)'/>
      <xsl:if test='$HOME.count=1'>
        <parameters><type><text>home</text></type></parameters>
      </xsl:if>
      <xsl:if test='$WORK.count=1'>
        <parameters><type><text>work</text></type></parameters>
      </xsl:if>
      <xsl:if test='$TEXT.count=1'>
        <parameters><type><text>text</text></type></parameters>
      </xsl:if>
      <xsl:if test='$VOICE.count=1'>
        <parameters><type><text>voice</text></type></parameters>
      </xsl:if>
      <xsl:if test='$FAX.count=1'>
        <parameters><type><text>fax</text></type></parameters>
      </xsl:if>
      <xsl:if test='$CELL.count=1'>
        <parameters><type><text>cell</text></type></parameters>
      </xsl:if>
      <xsl:if test='$VIDEO.count=1'>
        <parameters><type><text>video</text></type></parameters>
      </xsl:if>
      <xsl:if test='$PAGER.count=1'>
        <parameters><type><text>pager</text></type></parameters>
      </xsl:if>
      <xsl:if test='$TEXTPHONE.count=1'>
        <parameters><type><text>textphone</text></type></parameters>
      </xsl:if>
      <xsl:if test='$NUMBER.count=1'>
        <uri><xsl:text>tel:</xsl:text><xsl:value-of select='NUMBER'/></uri>
      </xsl:if>
    </tel>
  </xsl:template>

  <xsl:template match='EMAIL'>
    <email>
      <xsl:variable name='HOME.count' select='count(HOME)'/>
      <xsl:variable name='WORK.count' select='count(WORK)'/>
      <!-- NOTE: vcard-temp allowed email types of INTERNET
           and X400, but they were never in vCard3 -->
      <xsl:variable name='PREF.count' select='count(PREF)'/>
      <xsl:variable name='USERID.count' select='count(USERID)'/>
      <xsl:if test='$HOME.count=1'>
        <parameters><type><text>home</text></type></parameters>
      </xsl:if>
      <xsl:if test='$WORK.count=1'>
        <parameters><type><text>work</text></type></parameters>
      </xsl:if>
      <xsl:if test='$PREF.count=1'>
        <parameters><pref><integer>1</integer></pref></parameters>
      </xsl:if>
      <xsl:if test='$USERID.count=1'>
        <text><xsl:value-of select='USERID'/></text>
      </xsl:if>
    </email>
  </xsl:template>

</xsl:stylesheet>
    ]]></code>
</section1>

<section1 topic='Acknowledgements' anchor='acks'>
  <p>Thanks to Joe Hildebrand, Waqas Hussain, and Matt Miller for their feedback.</p>
</section1>

</xep>
