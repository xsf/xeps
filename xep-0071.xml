<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE xep SYSTEM 'xep.dtd' [
  <!ENTITY % ents SYSTEM 'xep.ent'>
%ents;
]>
<?xml-stylesheet type='text/xsl' href='xep.xsl'?>
<xep>
<header>
  <title>XHTML-IM</title>
  <abstract>This specification defines an XHTML 1.0 Integration Set for use in exchanging instant messages that contain lightweight text markup. The protocol enables an XMPP entity to format a message using a small range of commonly-used HTML elements, attributes, and style properties that are suitable for use in instant messaging. The protocol also excludes HTML constructs that may introduce malware and other vulnerabilities (such as scripts and objects) for improved security.</abstract>
  &LEGALNOTICE;
  <number>0071</number>
  <status>Draft</status>
  <type>Standards Track</type>
  <sig>Standards</sig>
  <dependencies>
    <spec>XMPP Core</spec>
    <spec>XMPP IM</spec>
    <spec>XHTML 1.0</spec>
    <spec>Modularization of XHTML</spec>
    <spec>XEP-0030</spec>
  </dependencies>
  <supersedes/>
  <supersededby/>
  <shortname>xhtml-im</shortname>
  <schemaloc>
    <ns>wrapper namespace</ns>
    <url>http://www.xmpp.org/schemas/xhtml-im-wrapper.xsd</url>
  </schemaloc>
  <schemaloc>
    <ns>schema driver</ns>
    <url>http://www.xmpp.org/schemas/xhtml-im-driver.xsd</url>
  </schemaloc>
  <schemaloc>
    <ns>content model</ns>
    <url>http://www.xmpp.org/schemas/xhtml-im-model.xsd</url>
  </schemaloc>
  &stpeter;
  <revision>
    <version>1.5</version>
    <date>2012-11-28</date>
    <initials>psa</initials>
    <remark><p>Addressed feedback received during Call for Experience: (1) generalized business rule about not adding XHTML rendering in the receiving client, (2) modified business rule about structure vs. style to recommend structural elements.</p></remark>
  </revision>
  <revision>
    <version>1.4</version>
    <date>2008-09-03</date>
    <initials>psa</initials>
    <remark><p>Encouraged support for several more structural elements from the text module (blockquote, cite, em, and strong); further clarified security considerations regarding fetching and presentation of images; modified several examples; clarified several points throughout the text.</p></remark>
  </revision>
  <revision>
    <version>1.3</version>
    <date>2007-08-29</date>
    <initials>psa</initials>
    <remark><p>Reorganized and further clarified security considerations regarding malicious objects, phishing, and presence leaks; added business rule about inclusion and processing of hyperlinks.</p></remark>
  </revision>
  <revision>
    <version>1.2</version>
    <date>2007-03-14</date>
    <initials>psa</initials>
    <remark><p>Clarified security considerations regarding images.</p></remark>
  </revision>
  <revision>
    <version>1.1</version>
    <date>2006-01-11</date>
    <initials>psa</initials>
    <remark><p>More clearly specified that XHTML-IM content is intended for use only within message stanzas, that it may be included in IQ stanzas (usage undefined) and that it may be included in presence stanzas (usage: formatted version of status); specified security consideration regarding hyperlinks.</p></remark>
  </revision>
  <revision>
    <version>1.0</version>
    <date>2004-09-29</date>
    <initials>psa</initials>
    <remark><p>Per a vote of the Jabber Council, advanced status to Draft.</p></remark>
  </revision>
  <revision>
    <version>0.19</version>
    <date>2004-09-27</date>
    <initials>psa</initials>
    <remark><p>Per list discussion, removed recommendation to preserve whitespace in XHTML bodies (instead, use of &lt;br/&gt; and non-breaking spaces is recommended); noted that nesting of elements is not recommended except within &lt;div/&gt; elements; and switched from padding-left to margin-left for indentation.</p></remark>
  </revision>
  <revision>
    <version>0.18</version>
    <date>2004-09-15</date>
    <initials>psa</initials>
    <remark><p>Added recommendation to preserve whitespace in XHTML bodies.</p></remark>
  </revision>
  <revision>
    <version>0.17</version>
    <date>2004-09-08</date>
    <initials>psa</initials>
    <remark><p>Simplified the recommended profiles based on list discussion; changed the examples accordingly.</p></remark>
  </revision>
  <revision>
    <version>0.16</version>
    <date>2004-08-30</date>
    <initials>psa</initials>
    <remark><p>Specified the scope of the proposal; clarified reasons for the choice of technology; clarified one business rule; corrected several typographical errors.</p></remark>
  </revision>
  <revision>
    <version>0.15</version>
    <date>2004-07-29</date>
    <initials>psa</initials>
    <remark><p>Based on W3C feedback, added content model and refactored the text to ensure separation between the XHTML 1.0 Integration Set itself and the XSF's recommended profile of the Integration Set; also split the requirements out from the Concepts and Approach section, added several more examples, and showed renderings of the examples.</p></remark>
  </revision>
  <revision>
    <version>0.14</version>
    <date>2004-05-19</date>
    <initials>psa</initials>
    <remark><p>Clarified relationship between wrapper element and XHTML content.</p></remark>
  </revision>
  <revision>
    <version>0.13</version>
    <date>2004-05-18</date>
    <initials>psa</initials>
    <remark><p>Initial version of XHTML modularization.</p></remark>
  </revision>
  <revision>
    <version>0.12</version>
    <date>2004-03-10</date>
    <initials>psa</initials>
    <remark><p>Clarified and corrected several points in the text; improved and added to the examples.</p></remark>
  </revision>
  <revision>
    <version>0.11</version>
    <date>2003-12-05</date>
    <initials>psa</initials>
    <remark><p>Defined XHTML 1.0 Integration Set conformance; removed schema pending work on XHTML modularization with W3C.</p></remark>
  </revision>
  <revision>
    <version>0.10</version>
    <date>2003-11-25</date>
    <initials>psa</initials>
    <remark><p>Cleaned up the schema; added W3C considerations.</p></remark>
  </revision>
  <revision>
    <version>0.9</version>
    <date>2003-09-30</date>
    <initials>psa</initials>
    <remark><p>Changed status to Deferred pending discussion with the W3C regarding XHTML modularization.</p></remark>
  </revision>
  <revision>
    <version>0.8</version>
    <date>2003-09-16</date>
    <initials>psa</initials>
    <remark><p>Changed MUST to SHOULD for support of the Style Attribute Module; clarified relationship of XHTML-IM schema to XHTML schema; slight text cleanup.</p></remark>
  </revision>
  <revision>
    <version>0.7</version>
    <date>2003-08-19</date>
    <initials>psa</initials>
    <remark><p>Added the &lt;code/&gt; element.</p></remark>
  </revision>
  <revision>
    <version>0.6</version>
    <date>2003-06-24</date>
    <initials>psa</initials>
    <remark><p>Made image support recommended (not mandatory); removed references to conversation threads; fixed some issues in the schema; made small editorial changes throughout.</p></remark>
  </revision>
  <revision>
    <version>0.5</version>
    <date>2003-04-29</date>
    <initials>psa</initials>
    <remark><p>Fixed the schema, made several small editorial changes.</p></remark>
  </revision>
  <revision>
    <version>0.4</version>
    <date>2003-02-20</date>
    <initials>psa</initials>
    <remark><p>Brought back several content-based elements; added preliminary schema.</p></remark>
  </revision>
  <revision>
    <version>0.3</version>
    <date>2003-02-19</date>
    <initials>psa</initials>
    <remark><p>Defined the attributes and style properties required by this document.</p></remark>
  </revision>
  <revision>
    <version>0.2</version>
    <date>2003-02-17</date>
    <initials>psa</initials>
    <remark><p>Described the requirements more fully; added additional restrictions above and beyond the standard XHTML 1.0 Modules; added disco examples.</p></remark>
  </revision>
  <revision>
    <version>0.1</version>
    <date>2003-02-16</date>
    <initials>psa</initials>
    <remark><p>Initial version.</p></remark>
  </revision>
</header>
<section1 topic='Introduction' anchor='intro'>
  <p>This document defines methods for exchanging instant messages that contain lightweight text markup. In the context of this document, "lightweight text markup" is to be understood as a combination of minimal structural elements and presentational styles that can easily be rendered on a wide variety of devices without requiring a full rich-text rendering engine such as a web browser. Examples of lightweight text markup include basic text blocks (e.g., paragraphs and blockquotes), structural elements (e.g., emphasis and strength), lists, hyperlinks, image references, and font styles (e.g., sizes and colors).</p>
  <p>Note: This specification essentially defines a recommended set of XHTML elements and attributes for use in instant messaging by applying a series of "filters" to the wealth of XHTML features; however, developers of Jabber/XMPP clients mainly need to pay attention to the <link url='#profile-summary'>Summary of Recommendations</link> rather than the complexities of how the recommendations are derived.</p>
</section1>
<section1 topic='Choice of Technology' anchor='tech'>
  <p>In the past, there have existed several incompatible methods within the Jabber community for exchanging instant messages that contain lightweight text markup. The most notable such methods have included derivatives of &w3xhtml; as well as of &rtf;.</p>
  <p>Although it is sometimes easier for client developers to implement RTF support (this is especially true on certain Microsoft Windows operating systems), there are several reasons (consistent with the &xep0134;) for the &XSF; to avoid the use of RTF in developing a protocol for lightweight text markup. Specifically:</p>
  <ol>
    <li>RTF is not a structured vocabulary derived from SGML (as is &w3html;) or, more relevantly, from XML (as is XHTML 1.0).</li>
    <li>RTF is under the control of the Microsoft Corporation and thus is not an open standard maintained by a recognized standards development organization; therefore the XSF is unable to contribute to or influence its development if necessary, and any protocol the XSF developed using RTF would introduce unwanted dependencies.</li>
  </ol>
  <p>Conversely, there are several reasons to prefer XHTML for lightweight text markup:</p>
  <ol>
    <li>XHTML is a structured format that is defined as an application of &w3xml;, making it especially appropriate for sending over Jabber/XMPP, which is at root a technology for streaming XML (see &xmppcore;).</li>
    <li>XHTML is an open standard developed by the &W3C;, a recognized standards development organization.</li>
  </ol>
  <p>Therefore, this document defines support for lightweight text markup in the form of an XMPP extension that encapsulates content defined by an XHTML 1.0 Integration Set that we label "XHTML-IM". The remainder of this document discusses lightweight text markup in terms of XHTML 1.0 only and does not further consider RTF or other technologies.</p>
</section1>
<section1 topic='Requirements' anchor='reqs'>
  <p>HTML was originally designed for authoring and presenting stuctured documents on the World Wide Web, and was subsequently extended to handle more advanced functionality such as image maps and interactive forms. However, the requirements for publishing documents (or developing transactional websites) for presentation by dedicated XHTML user agents on traditional computers or small-screen devices are fundamentally different from the requirements for lightweight text markup of instant messages; for this reason, only a reduced set of XHTML features is needed for XHTML-IM. In particular:</p>
  <ol>
    <li><p>IM clients are not XHTML clients: their primary purpose is not to read pre-existing XHTML documents, but to read <em>and generate</em> relatively large numbers of fairly small instant messages.</p></li>
    <li><p>The underlying context for XHTML content in Jabber/XMPP instant messaging is provided not by a full XHTML document, but by an XML stream, and specifically by a message stanza within that stream. Thus the &lt;head/&gt; element and all its children are unnecessary. Only the &lt;body/&gt; element and some of its children are appropriate for use in instant messaging.</p></li>
    <li><p>The XHTML content that is read by one's IM client is normally generated on the fly by one's conversation partner (or, to be precise, by his or her IM client). Thus there is an inherent limit to the sophistication of the XHTML markup involved. Even in normal XHTML documents, fairly basic structural and rendering elements such as definition lists, abbreviations, addresses, and computer input handling (e.g., &lt;kbd/&gt; and &lt;var/&gt;) are relatively rare. There is little or no foreseeable need for such elements within the context of instant messaging.</p></li>
    <li><p>The foregoing is doubly true of more advanced markup such as tables, frames, and forms (however, there exists an XMPP extension that provides an instant messaging equivalent of the latter, as defined in &xep0004;).</p></li>
    <li><p>Although ad-hoc styles are useful for messaging (by means of the 'style' attribute), full support for &w3css; (defined by the &lt;style/&gt; element or a standalone .css file, and implemented via the 'class' attribute) would be overkill since many CSS1 properties (e.g., box, classification, and text properties) were developed especially for sophisticated page layout.</p></li>
    <li><p>Background images, audio, animated text, layers, applets, scripts, and other multimedia content types are unnecessary, especially given the existence of XMPP extensions such as &xep0096;, &xep0166;, and &xep0234;.</p></li>
    <li><p>Content transformations such as those defined by &w3xslt; must not be necessary in order for an instant messaging application to present lightweight text markup to an end user.</p></li>
  </ol>
  <p>As explained below, some of these requirements are addressed by the definition of the XHTML-IM Integration Set itself, while others are addressed by a recommended "profile" for that Integration Set in the context of instant messaging applications.</p>
</section1>
<section1 topic='Concepts and Approach' anchor='concepts'>
  <p>This document defines an adaptation of XHTML 1.0 (specifically, an XHTML 1.0 Integration Set) that makes it possible to provide lightweight text markup of instant messages (mainly for Jabber/XMPP instant messages, although the Integration Set defined herein could be used by other protocols). This pattern is familiar from email, wherein the HTML-formatted version of the message supplements but does not supersede the text-only version of the message. <note>The XHTML is merely an alternative version of the message body or bodies, and the semantic meaning is to be derived from the textual message body or bodies rather than the XHTML version.</note></p>
  <p>In Jabber/XMPP communications, the meaning (as opposed to markup) of the message MUST always be represented as best as possible in the normal &lt;body/&gt; child element or elements of the &MESSAGE; stanza qualified by the 'jabber:client' (or 'jabber:server') namespace. Lightweight text markup is then provided within an &lt;html/&gt; element qualified by the 'http://jabber.org/protocol/xhtml-im' namespace. <note>It might have been better to use an element name other than &lt;html/&gt; for the wrapper element; however, changing it would not be backwards-compatible with the older protocol and existing implementations.</note> However, this &lt;html/&gt; element is used solely as a "wrapper" for the XHTML content itself, which content is encapsulated via one or more &lt;body/&gt; elements qualified by the 'http://www.w3.org/1999/xhtml' namespace, along with appropriate child elements thereof.</p>
  <p>The following example illustrates this approach.</p>
  <example caption='A simple example'><![CDATA[
<message>
  <body>hi!</body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xmlns='http://www.w3.org/1999/xhtml'>
      <p style='font-weight:bold'>hi!</p>
    </body>
  </html>
</message>
  ]]></example>
  <p>Technically speaking, there are three aspects to the approach taken herein:</p>
  <ol>
    <li>Definition of the &lt;html/&gt; "wrapper" element, which functions as an XMPP extension within XMPP &lt;message/&gt; stanzas.</li>
    <li>Definition of the XHTML-IM Integration Set itself in terms of supported XHTML 1.0 modules, using the concepts defined in &w3xhtmlmod;.</li>
    <li>A recommended "profile" regarding the specific XHTML 1.0 elements and attributes to be supported from each XHTML 1.0 module.</li>
  </ol>
  <p>These three aspects are defined in the three document sections that follow.</p>
</section1>
<section1 topic='Wrapper Element' anchor='wrapper'>
  <p>The root element for including XHTML content within XMPP stanzas is &lt;html/&gt;. This element is qualified by the 'http://jabber.org/protocol/xhtml-im' namespace. From the perspective of XMPP, the wrapper element functions as an XMPP extension element; from the perspective of XHTML, it functions as a wrapper for XHTML 1.0 content qualified by the 'http://www.w3.org/1999/xhtml' namespace. Such XHTML content MUST be contained in one or more &lt;body/&gt; elements qualified by the 'http://www.w3.org/1999/xhtml' namespace and MUST conform to the XHTML-IM Integration Set defined in the following section. If more than one &lt;body/&gt; element is included in the &lt;html/&gt; wrapper element, each &lt;body/&gt; element MUST possess an 'xml:lang' attribute with a distinct value, where the value of that attribute MUST adhere to the rules defined in &rfc5646;. A formal definition of the &lt;html/&gt; element is provided in the <link url="#schemas-wrapper">XHTML-IM Wrapper Schema</link>.</p>
  <p>The XHTML &lt;body/&gt; element is not to be confused with the XMPP &lt;body/&gt; element, which is a child of a &MESSAGE; stanza and is qualified by the 'jabber:client' or 'jabber:server' namespace as described in &xmppim;. The &lt;html/&gt; wrapper element is intended for inclusion only as a direct child element of the XMPP &MESSAGE; stanza and only in order to specify a marked-up version of the message &BODY; element or elements, but MAY be included elsewhere in accordance with the "extended namespace" rules defined in the <cite>XMPP IM</cite> specification.</p>
  <p>Until and unless (1) additional integration sets are defined and (2) mechanisms are specified for discovering or negotiating which integration sets are supported, the XHTML markup contained within the &lt;html/&gt; wrapper element:</p>
  <ol>
    <li>MUST NOT include elements and attributes that are not part of the XHTML-IM Integration Set defined in Section 6 of this document; any such elements and attributes MUST be ignored if received.</li>
    <li>SHOULD NOT include elements and attributes that are not part of the recommended profile of the XHTML-IM Integration Set defined in Section 7 of this document; any such elements and attributes SHOULD be ignored if received.</li>
  </ol>
  <p>Note: In the foregoing restrictions, the meaning of "ignore" is defined by the conformance requirements of <cite>Modularization of XHTML</cite>, as summarized in the <link url="#w3c-conformance">User Agent Conformance</link> section of this document).</p>
</section1>
<section1 topic='XHTML-IM Integration Set' anchor='def'>
  <p>This section defines an XHTML 1.0 Integration Set for use in the context of instant messaging. Given its intended usage, we label it "XHTML-IM".</p>
  <p><cite>Modularization of XHTML</cite> provides the ability to formally define subsets of XHTML 1.0 via the concept of "modularization" (which may be familiar from &w3xhtmlbasic;). Many of the defined modules are not necessary or useful in the context of instant messaging, and in the context of Jabber/XMPP instant messaging specifically some modules have been superseded by well-defined XMPP extensions. This document specifies that XHTML-IM shall be based on the following XHTML 1.0 modules:</p>
  <ul>
    <li>Core Modules
      <ul>
        <li>Structure Module</li>
        <li>Text Module</li>
        <li>Hypertext Module</li>
        <li>List Module</li>
      </ul>
    </li>
    <li>Image Module</li>
    <li>Style Attribute Module</li>
  </ul>
  <p><cite>Modularization of XHTML</cite> defines many additional modules, such as Table Modules, Form Modules, Object Modules, and Frame Modules. None of these modules is part of the XHTML-IM Integration Set. If support for such modules is desired, it MUST be defined in a separate and distinct integration set.</p>
  <section2 topic='Structure Module Definition' anchor='def-structure'>
    <p>The Structure Module is defined as including the following elements and attributes: <note>The 'style' attribute is specified herein where appropriate because the Style Attribute Module is included in the definition of the XHTML-IM Integration Set, whereas the event-related attributes (e.g., 'onclick') are not specified because the Implicit Events Module is not included.</note></p>
    <table caption='Defined Structure Module Elements and Attributes'>
      <tr><th>Element</th><th>Attributes</th></tr>
      <tr><td>&lt;body/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;head/&gt;</td><td>profile</td></tr>
      <tr><td>&lt;html/&gt;</td><td>version</td></tr>
      <tr><td>&lt;title/&gt;</td><td></td></tr>
    </table>
  </section2>
  <section2 topic='Text Module Definition' anchor='def-text'>
    <p>The Text Module is defined as including the following elements and attributes:</p>
    <table caption='Defined Text Module Elements and Attributes'>
      <tr><th>Element</th><th>Attributes</th></tr>
      <tr><td>&lt;abbr/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;acronym/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;address/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;blockquote/&gt;</td><td>class, id, title; style; cite</td></tr>
      <tr><td>&lt;br/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;cite/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;code/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;dfn/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;div/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;em/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;h1/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;h2/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;h3/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;h4/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;h5/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;h6/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;kbd/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;p/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;pre/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;q/&gt;</td><td>class, id, title; style; cite</td></tr>
      <tr><td>&lt;samp/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;span/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;strong/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;var/&gt;</td><td>class, id, title; style</td></tr>
    </table>
  </section2>
  <section2 topic='Hypertext Module Definition' anchor='def-hypertext'>
    <p>The Hypertext Module is defined as including the &lt;a/&gt; element only:</p> 
    <table caption='Defined Hypertext Module Elements and Attributes'>
      <tr><th>Element</th><th>Attributes</th></tr>
      <tr><td>&lt;a/&gt;</td><td>class, id, title; style; accesskey, charset, href, hreflang, rel, rev, tabindex, type</td></tr>
    </table>
  </section2>
  <section2 topic='List Module Definition' anchor='def-list'>
    <p>The List Module is defined as including the following elements and attributes:</p>
    <table caption='Defined List Module Elements and Attributes'>
      <tr><th>Element</th><th>Attributes</th></tr>
      <tr><td>&lt;dl/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;dt/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;dd/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;ol/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;ul/&gt;</td><td>class, id, title; style</td></tr>
      <tr><td>&lt;li/&gt;</td><td>class, id, title; style</td></tr>
    </table>
  </section2>
  <section2 topic='Image Module Definition' anchor='def-image'>
    <p>The Image Module is defined as including the &lt;img/&gt; element only:</p>
    <table caption='Defined Image Module Elements and Attributes'>
      <tr><th>Element</th><th>Attributes</th></tr>
      <tr><td>&lt;img/&gt;</td><td>class, id, title; style; alt, height, longdesc, src, width</td></tr>
    </table>
  </section2>
  <section2 topic='Style Attribute Module Definition' anchor='def-style'>
    <p>The Style Attribute Module is defined as including the style attribute only, as included in the preceding definition tables.</p>
  </section2>
</section1>
<section1 topic='Recommended Profile' anchor='profile'>
  <p>Even within the restricted set of modules specified as defining the XHTML-IM Integration Set (see preceding section), some elements and attributes are inappropriate or unnecessary for the purpose of instant messaging; although such elements and attributes MAY be included in accordance with the XHTML-IM Integration Set, further recommended restrictions regarding which elements and attributes to include in XHTML content are specified below.</p>
  <section2 topic='Structure Module Profile' anchor='profile-structure'>
    <p>The intent of the protocol defined herein is to support lightweight text markup of XMPP message bodies only. Therefore the &lt;head/&gt;, &lt;html/&gt;, and &lt;title/&gt; elements SHOULD NOT be generated by a compliant implementation, and SHOULD be ignored if received (where the meaning of "ignore" is defined by the conformance requirements of <cite>Modularization of XHTML</cite>, as summarized in the <link url="#w3c-conformance">User Agent Conformance</link> section of this document). However, the &lt;body/&gt; element is REQUIRED, since it is the root element for all XHTML-IM content.</p>
  </section2>
  <section2 topic='Text Module Profile' anchor='profile-text'>
    <p>Not all of the Text Module elements are appropriate in the context of instant messaging, since the XHTML content that one views is generated by one's conversation partner in what is often a rapid-fire conversation thread. Only the following elements are RECOMMENDED in XHTML-IM:</p>
    <ul>
      <li>&lt;blockquote/&gt;</li>
      <li>&lt;br/&gt;</li>
      <li>&lt;cite/&gt;</li>
      <li>&lt;em/&gt;</li>
      <li>&lt;p/&gt;</li>
      <li>&lt;span/&gt;</li>
      <li>&lt;strong/&gt;</li>
    </ul>
    <p>The other Text Module elements MAY be generated by a compliant implementation but MAY be ignored if received (where the meaning of "ignore" is defined by the conformance requirements of <cite>Modularization of XHTML</cite>, as summarized in the <link url="#w3c-conformance">User Agent Conformance</link> section of this document).</p>
  </section2>
  <section2 topic='Hypertext Module Profile' anchor='profile-hypertext'>
    <p>The only recommended attributes of the &lt;a/&gt; element are specified in the <link url="#profile-attributes">Recommended Attributes</link> section of this document.</p>
  </section2>
  <section2 topic='List Module Profile' anchor='profile-list'>
    <p>Because it is unlikely that an instant messaging user would generate a definition list, only ordered and unordered lists are RECOMMENDED. Definition lists SHOULD NOT be generated by a compliant implementation, and SHOULD be ignored if received (where the meaning of "ignore" is defined by the conformance requirements of <cite>Modularization of XHTML</cite>, as summarized in the <link url="#w3c-conformance">User Agent Conformance</link> section of this document).</p>
  </section2>
  <section2 topic='Image Module Profile' anchor='profile-image'>
    <p>The only recommended attributes of the &lt;img/&gt; element are specified in the <link url="#profile-attributes">Recommended Attributes</link> section of this document.</p>
    <p>The XHTML specification allows a "data:" URL &rfc2397; as the value of the 'src' attribute. This is NOT RECOMMENDED for use in XHTML-IM, because it can significantly increase the size of the message stanza and XMPP is not optimized for large stanzas. If the image data is small (less than 8 kilobytes), clients MAY use &xep0231; in coordination with XHTML-IM; if the image data is large, the value of the 'src' SHOULD be a pointer to an externally available file for the image (or the sender SHOULD use a dedicated file transfer method such as &xep0047; or &xep0065;).</p>
    <p>For security reasons or because of display constraints, a compliant client MAY choose to display 'alt' text only, not the image itself (for details, see the <link url='#security-code'>Malicious Objects</link> section of this document).</p>
  </section2>
  <section2 topic='Style Attribute Module Profile' anchor='profile-style'>
    <p>This module MUST be supported in XHTML-IM if possible; although clients written for certain platforms (e.g., console clients, mobile phones, and handheld computers) or for certain classes of users (e.g., text-to-speech clients) might not be able to support all of the recommended styles directly, they SHOULD attempt to emulate or translate the defined style properties into text or other presentation styles that are appropriate for the platform or user base in question.</p> 
    <p>A full list of recommended style properties is provided below.</p>
    <section3 topic='Recommended Style Properties' anchor='profile-style-properties'>
      <p><cite>CSS1</cite> defines 42 "atomic" style properties (which are categorized into font, color and background, text, box, and classification properties) as well as 11 "shorthand" properties ("font", "background", "margin", "padding", "border-width", "border-top", "border-right", "border-bottom", "border-left", "border", and "list-style"). Many of these properties are not appropriate for use in text-based instant messaging, for one or more of the following reasons:</p>
      <ol>
        <li>The property applies to or depends on the inclusion of images other than those handled by the XHTML Image Module (e.g., the "background-image", "background-repeat", "background-attachment", "background-position", and "list-style-image"  properties).</li>
        <li>The property is intended for advanced document layout (e.g., the "line-height" property and most of the box properties, with the exception of "margin-left", which is useful for indenting text, and "margin-right", which can be useful when dealing with images).</li>
        <li>The property is unnecessary since it can be emulated via user input or recommended XHTML stuctural elements (e.g., the "text-transform" property can be emulated by the user's keystrokes or use of the caps lock key)</li>
        <li>The property is otherwise unlikely to ever be used in the context of rapid-fire conversations (e.g., the "font-variant", "word-spacing", "letter-spacing", and "list-style-position" properties).</li>
        <li>The property is a shorthand property but some of the properties it includes are not appropriate for instant messaging applications according to the foregoing considerations (in fact this applies to all of the shorthand properties).</li>
      </ol>
      <p>Unfortunately, <cite>CSS1</cite> does not include mechanisms for defining profiles thereof (as does XHTML 1.0 in the form of XHTML Modularization). While there exist reduced sets of CSS2, these introduce more complexity than is desirable in the context of XHTML-IM. Therefore we simply provide a list of recommended CSS1 style properties.</p>
      <p>XHTML-IM stipulates that only the following style properties are RECOMMENDED:</p>
      <ul>
        <li>background-color</li>
        <li>color</li>
        <li>font-family</li>
        <li>font-size</li>
        <li>font-style</li>
        <li>font-weight</li>
        <li>margin-left</li>
        <li>margin-right</li>
        <li>text-align</li>
        <li>text-decoration</li>
      </ul>
      <p>Although a compliant implementation MAY generate or process other style properties defined in CSS1, such behavior is NOT RECOMMENDED by this document.</p>
    </section3>
  </section2>
  <section2 topic='Recommended Attributes' anchor='profile-attributes'>
    <section3 topic='Common Attributes' anchor='profile-attributes-common'>
      <p>Section 5.1 of <cite>Modularization of XHTML</cite> describes several "common" attribute collections: a "Core" collection ('class', 'id', 'title'), an "I18N" collection ('xml:lang', not shown below since it is implied in XML), an "Events" collection (not included in the XHTML-IM Integration Set because the Intrinsic Events Module is not selected), and a "Style" collection ('style'). The following table summarizes the recommended profile of these common attributes within the XHTML 1.0 content itself:</p>
      <table caption='Recommended Usage of Common Attributes'>
        <tr><th>Attribute</th><th>Usage</th><th>Reason</th></tr>
        <tr>
          <td>class</td>
          <td>NOT RECOMMENDED</td>
          <td>External stylesheets (which 'class' would typically reference) are not recommended.</td>
        </tr>
        <tr>
          <td>id</td>
          <td>NOT RECOMMENDED</td>
          <td>Internal links and message fragments are not recommended in IM content, nor are external stylesheets (which also make use of the 'id' attribute).</td>
        </tr>
        <tr>
          <td>title</td>
          <td>NOT RECOMMENDED</td>
          <td>Granting of titles to elements in IM content seems unnecessary.</td>
        </tr>
        <tr>
          <td>style</td>
          <td>REQUIRED</td>
          <td>The 'style' attribute is required since it is the vehicle for presentational styles.</td>
        </tr>
        <tr>
          <td>xml:lang</td>
          <td>NOT RECOMMENDED</td>
          <td>Differentiation of language identification SHOULD occur at the level of the &lt;body/&gt; element only.</td>
        </tr>
      </table>
    </section3>
    <section3 topic='Specialized Attributes' anchor='profile-attributes-special'>
      <p>Beyond the "common" attributes, certain elements within the modules selected for the XHTML-IM Integration Set are allowed to possess other attributes, such as eight attributes for the &lt;a/&gt; element and five attributes for the &lt;img/&gt; element. The recommended profile for such attributes is provided in the following table:</p>
      <table caption='Recommended Usage of Specialized Attributes'>
        <tr><th>Element Scope</th><th>Attribute</th><th>Usage</th></tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>accesskey</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>charset</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>href</td>
          <td>REQUIRED</td>
        </tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>hreflang</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>rel</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>rev</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>tabindex</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;a/&gt;</td>
          <td>type</td>
          <td>RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;cite/&gt;</td>
          <td>uri</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;img/&gt;</td>
          <td>alt</td>
          <td>REQUIRED</td>
        </tr>
        <tr>
          <td>&lt;img/&gt;</td>
          <td>height</td>
          <td>RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;img/&gt;</td>
          <td>longdesc</td>
          <td>NOT RECOMMENDED</td>
        </tr>
        <tr>
          <td>&lt;img/&gt;</td>
          <td>src</td>
          <td>REQUIRED</td>
        </tr>
        <tr>
          <td>&lt;img/&gt;</td>
          <td>width</td>
          <td>RECOMMENDED</td>
        </tr>
      </table>
    </section3>
    <section3 topic='Other Attributes' anchor='profile-attributes-other'>
      <p>Other XHTML 1.0 attributes SHOULD NOT be generated by a compliant implementation, and SHOULD be ignored if received (where the meaning of "ignore" is defined by the conformance requirements of <cite>Modularization of XHTML</cite>, as summarized in the <link url="#w3c-conformance">User Agent Conformance</link> section of this document).</p>
    </section3>
  </section2>
  <section2 topic='Summary of Recommendations' anchor='profile-summary'>
    <p>The following table summarizes the elements and attributes that are recommended within the XHTML-IM Integration Set.</p>
    <table caption='Recommended Elements and Attributes'>
      <tr>
        <th>Element</th>
        <th>Attributes</th>
      </tr>
      <tr>
        <td>&lt;a/&gt;</td>
        <td>href, style, type</td>
      </tr>
      <tr>
        <td>&lt;blockquote/&gt;</td>
        <td>style</td>
      </tr>
      <tr>
        <td>&lt;body/&gt;</td>
        <td>style, xml:lang <note>When contained within the &lt;html xmlns='http://jabber.org/protocol/xhtml-im'&gt; element, a &lt;body/&gt; element is qualified by the 'http://www.w3.org/1999/xhtml' namespace; naturally, this is a namespace declaration rather than an attribute per se, and therefore is not mentioned in the attribute enumeration.</note></td>
      </tr>
      <tr>
        <td>&lt;br/&gt;</td>
        <td>-none-</td>
      </tr>
      <tr>
        <td>&lt;cite/&gt;</td>
        <td>style</td>
      </tr>
      <tr>
        <td>&lt;em/&gt;</td>
        <td>-none-</td>
      </tr>
      <tr>
        <td>&lt;img/&gt;</td>
        <td>alt, height, src, style, width</td>
      </tr>
      <tr>
        <td>&lt;li/&gt;</td>
        <td>style</td>
      </tr>
      <tr>
        <td>&lt;ol/&gt;</td>
        <td>style</td>
      </tr>
      <tr>
        <td>&lt;p/&gt;</td>
        <td>style</td>
      </tr>
      <tr>
        <td>&lt;span/&gt;</td>
        <td>style</td>
      </tr>
      <tr>
        <td>&lt;strong/&gt;</td>
        <td>-none-</td>
      </tr>
      <tr>
        <td>&lt;ul/&gt;</td>
        <td>style</td>
      </tr>
    </table>
    <p>Any other elements and attributes defined in the XHTML 1.0 modules that are included in the XHTML-IM Integration Set SHOULD NOT be generated by a compliant implementation, and SHOULD be ignored if received (where the meaning of "ignore" is defined by the conformance requirements of <cite>Modularization of XHTML</cite>, as summarized in the <link url="#w3c-conformance">User Agent Conformance</link> section of this document).</p>
  </section2>
</section1>
<section1 topic='Business Rules' anchor='bizrules'>
  <p>The following rules apply to the generation and processing of XHTML content by Jabber clients or other XMPP entities.</p>
  <ol>
    <li><p>XHTML-IM content is designed to provide a formatted version of the XML character data provided in the &BODY; of an XMPP &MESSAGE; stanza; if such content is included in an XMPP message, the &lt;html/&gt; element MUST be a direct child of the &MESSAGE; stanza and the XHTML-IM content MUST be understood as a formatted version of the message body. XHTML-IM content MAY be included within XMPP &IQ; stanzas (or children thereof), but any such usage is undefined. In order to preserve bandwidth, XHTML-IM content SHOULD NOT be included within XMPP &PRESENCE; stanzas; however, if it is so included, the &lt;html/&gt; element MUST be a direct child of the &PRESENCE; stanza and the XHTML-IM content MUST be understood as a formatted version of the XML character data provided in the &STATUS; element.</p></li>
    <li><p>The sending client MUST ensure that, if XHTML content is sent, its meaning is the same as that of the plaintext version, and that the two versions differ only in markup rather than meaning.</p></li>
    <li><p>XHTML-IM is a reduced set of <cite>XHTML 1.0</cite> and thus also of <cite>XML 1.0</cite>. Therefore all opening tags MUST be completed by inclusion of an appropriate closing tag.</p></li>
    <li><p><cite>XMPP Core</cite> specifies that an XMPP &MESSAGE; MAY contain more than one &lt;body/&gt; child as long as each &lt;body/&gt; possesses an 'xml:lang' attribute with a distinct value. In order to ensure correct internationalization, if an XMPP &MESSAGE; stanza contains more than one &lt;body/&gt; child and is also sent as XHTML-IM, the &lt;html/&gt; element SHOULD also contain more than one &lt;body/&gt; child, with one such element for each &lt;body/&gt; child of the &MESSAGE; stanza (distinguished by an appropriate 'xml:lang' attribute).</p></li>
    <li><p>Section 11.1 of <cite>XMPP Core</cite> stipulates that character entities other than the five general entities defined in Section 4.6 of the XML specification (i.e., &amp;lt;, &amp;gt;, &amp;amp;, &amp;apos;, and &amp;quot;) MUST NOT be sent over an XML stream. Therefore implementations of XHTML-IM MUST NOT include predefined XHTML 1.0 entities such as &amp;nbsp; -- instead, implementations MUST use the equivalent character references as specified in Section 4.1 of the XML specification (even in non-obvious places such as URIs that are included in the 'href' attribute).</p></li>
    <li><p>For elements and attributes qualified by the 'http://www.w3.org/1999/xhtml' namespace, user agent conformance is guided by the requirements defined in <cite>Modularization of XHTML</cite>; for details, refer to the <link url="#w3c-conformance">User Agent Conformance</link> section of this document.</p></li>
    <li><p>Where strictly presentational style are desired (e.g., colored text), it might be necessary to use 'style' attributes (e.g., &lt;span style='font-color: green'&gt;this is green&lt;/span&gt;). However, where possible it is instead RECOMMENDED to use appropriate structural elements (e.g., &lt;strong/&gt; and &lt;blockquote/&gt; instead of, say, style='font-weight: bold' or style='margin-left: 5%').</p></li>
    <li><p>Nesting of block structural elements (&lt;p/&gt;) and list elements (&lt;dl/&gt;, &lt;ol/&gt;, &lt;ul/&gt;) is NOT RECOMMENDED, except within &lt;div/&gt; elements.</p></li>
    <li><p>It is RECOMMENDED for implementations to replace line breaks with the &lt;br/&gt; element and to replace significant whitepace with the appropriate number of non-breaking spaces (via the NO-BREAK SPACE character or its equivalent), where "significant whitespace" means whitespace that makes some material difference (e.g., one or more spaces at the beginning of a line or more than one space anywhere else within a line), not "normal" whitespace separating words or punctuation.</p></li>
    <li><p>When rendering XHTML-IM content, a receiving user agent MUST NOT render as XHTML any text that was not structured by the sending user agent using XHTML elements and attributes; if the sender wishes text to be structured (e.g., for certain words to be emphasized or for URIs to be linked), the sending user agent MUST represent the text using the appropriate XHTML elements and attributes.</p></li>
  </ol>
</section1>
<section1 topic='Examples' anchor='examples'>
  <p>The following examples provide an insight into the inclusion of XHTML content in XMPP &MESSAGE; stanzas but are by no means exhaustive or definitive.</p>
  <p>(Note: The examples might not render correctly in all web browsers, since not all web browsers comply fully with the XHTML 1.0 and CSS1 standards. Markup in the examples may include line breaks for readability. Example renderings are shown with a colored background to set them off from the rest of the text.)</p>
  <example caption='Emphasis, font colors, strength'><![CDATA[
<message>
  <body>Wow, I&apos;m green with envy!</body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xmlns='http://www.w3.org/1999/xhtml'>
      <p style='font-size:large'>
        <em>Wow</em>, I&apos;m <span style='color:green'>green</span>
        with <strong>envy</strong>!
      </p>
    </body>
  </html>
</message>
  ]]></example>
  <p>This could be rendered as follows:</p>
  <div class='example'>
    <p style='font-size: large'><em>Wow</em>, I&apos;m <span style='color:green'>green</span> with <strong>envy</strong>!</p>
  </div>
  <example caption='Blockquote, cite'><![CDATA[
<message>
  <body>As Emerson said in his essay Self-Reliance:

     &quot;A foolish consistency is the hobgoblin of little minds.&quot;
  </body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xmlns='http://www.w3.org/1999/xhtml'>
      <p>As Emerson said in his essay <cite>Self-Reliance</cite>:</p>
      <blockquote>
        &quot;A foolish consistency is the hobgoblin of little minds.&quot;
      </blockquote>
    </body>
  </html>
</message>
  ]]></example>
  <p>This could be rendered as follows:</p>
  <div class='example'>
    <p>As Emerson said in his essay <cite>Self-Reliance</cite>:</p>
    <blockquote>
      &quot;A foolish consistency is the hobgoblin of little minds.&quot;
    </blockquote>
  </div>
  <example caption='An image and a hyperlink'><![CDATA[
<message>
  <body>Hey, are you licensed to Jabber?

  http://www.xmpp.org/images/psa-license.jpg
  </body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xmlns='http://www.w3.org/1999/xhtml'>
      <p>Hey, are you licensed to <a href='http://www.jabber.org/'>Jabber</a>?</p>
      <p><img src='http://www.xmpp.org/images/psa-license.jpg'
              alt='A License to Jabber'
              height='261'
              width='537'/></p>
    </body>
  </html>
</message>
  ]]></example>
  <p>This could be rendered as follows:</p>
  <div class='indent'>
    <p>Hey, are you licensed to <link url='http://www.jabber.org/'>Jabber</link>?</p>
    <p><img src='http://www.xmpp.org/images/psa-license.jpg' alt='A License to Jabber' height='261' width='537'/></p>
  </div>
  <p>Note the large size of the image. Including the 'height' and 'width' attributes is therefore quite friendly, since it gives the receiving application hints as to whether the image is too large to fit into the current interface (naturally, these are hints only and cannot necessarily be relied upon in determining the size of the image).</p>
  <p>Rendering the 'alt' value rather than the image would yield something like the following:</p>
  <div class='example'>
    <p>Hey, are you licensed to <link url='http://www.jabber.org/'>Jabber</link>?</p>
    <p>IMG: "A License to Jabber"</p>
  </div>
  <example caption='Two lists'><![CDATA[
<message>
  <body>Here&apos;s my .plan for today:
  1. Add the following examples to XEP-0071:
     - ordered and unordered lists
     - more styles (e.g., indentation)
  2. Kick back and relax
  </body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xmlns='http://www.w3.org/1999/xhtml'>
      <p>Here&apos;s my .plan for today:</p>
      <ol>
        <li>Add the following examples to XEP-0071:
          <ul>
            <li>ordered and unordered lists</li>
            <li>more styles (e.g., indentation)</li>
          </ul>
        </li>
        <li>Kick back and relax</li>
      </ol>
    </body>
  </html>
</message>
  ]]></example>
  <p>This could be rendered as follows:</p>
  <div class='example'>
    <p>Here&apos;s my .plan for today:</p>
    <ol>
      <li>Add the following examples to XEP-0071:
        <ul>
          <li>ordered and unordered lists</li>
          <li>more styles (e.g., indentation)</li>
        </ul>
      </li>
      <li>Kick back and relax</li>
    </ol>
  </div>
  <example caption='Quoted text'><![CDATA[
<message>
  <body>
You wrote:

   I think we have consensus on the following:

   1. Remove &lt;div/&gt;
   2. Nesting is not recommended
   3. Don't preserve whitespace

   Yes, no, maybe?

That seems fine to me.
  </body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xmlns='http://www.w3.org/1999/xhtml'>
      <p>You wrote:</p>
      <blockquote>
        <p>I think we have consensus on the following:</p>
        <ol>
          <li>Remove &lt;div/&gt;</li>
          <li>Nesting is not recommended</li>
          <li>Don't preserve whitespace</li>
        </ol>
        <p>Yes, no, maybe?</p>
      </blockquote>
      <p>That seems fine to me.</p>
    </body>
  </html>
</message>
  ]]></example>
  <p>Although quoting received messages is relatively uncommon in IM, it does happen. This could be rendered as follows:</p>
  <div class='example'>
      <p>You wrote:</p>
      <div style='margin-left: 5%'>
        <p>I think we have consensus on the following:</p>
        <ol>
          <li>Remove &lt;div/&gt;</li>
          <li>Nesting is not recommended</li>
          <li>Don't preserve whitespace</li>
        </ol>
        <p>Yes, no, maybe?</p>
      </div>
      <p>That seems fine to me.</p>
  </div>
  <example caption='Multiple bodies'><![CDATA[
<message>
  <body xml:lang='en-US'>awesome!</body>
  <body xml:lang='de-DE'>ausgezeichnet!</body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xml:lang='en-US' xmlns='http://www.w3.org/1999/xhtml'>
      <p><strong>awesome!</strong></p>
    </body>
    <body xml:lang='de-DE' xmlns='http://www.w3.org/1999/xhtml'>
      <p><strong>ausgezeichnet!</strong></p>
    </body>
  </html>
</message>
  ]]></example>
  <p>How multiple bodies would best be rendered will depend on the user agent and relevant application. For example, a specialized Jabber client that is used in foreign language instruction might show two languages side by side, whereas a dedicated IM client might show content only in a human user's preferred language as captured in the client configuration.</p>
  <example caption='Unrecognized Elements and Attributes'><![CDATA[
<message>
  <body>
    The XHTML user agent conformance requirements say to ignore
    elements and attributes you don't understand, to wit:

      4. If a user agent encounters an element it does 
         not recognize, it must continue to process the 
         children of that element. If the content is text, 
         the text must be presented to the user.

      5. If a user agent encounters an attribute it does 
         not recognize, it must ignore the entire attribute 
         specification (i.e., the attribute and its value).
  </body>
  <html xmlns='http://jabber.org/protocol/xhtml-im'>
    <body xmlns='http://www.w3.org/1999/xhtml'>
      <p>The <acronym>XHTML</acronym> user agent conformance 
         requirements say to ignore elements and attributes 
         you don't understand, to wit:</p>
      <ol type='1' start='4'>
        <li><p>
          If a user agent encounters an element it does 
          not recognize, it must continue to process the 
          children of that element. If the content is text,
          the text must be presented to the user.
        </p></li>
        <li><p>
          If a user agent encounters an attribute it does 
          not recognize, it must ignore the entire attribute 
          specification (i.e., the attribute and its value).
        </p></li>
      </ol>
    </body>
  </html>
</message>
  ]]></example>
  <p>Let us assume that the recipient's user agent recognizes neither the &lt;acronym/&gt; element (which is discouraged in XHTML-IM) nor the 'type' and 'start' attributes of the &lt;ol/&gt; element (which, after all, were deprecated in HTML 4.0), and that it does not render nested elements (e.g., the &lt;p/&gt; elements within the &lt;li/&gt; elements); in this case, it could render the content as follows (note that the element value is shown as text and the attribute value is not rendered):</p>
  <div class='example'>
    <p>The <acronym>XHTML</acronym> user agent conformance requirements say to ignore elements and attributes you don't understand, to wit:</p>
    <ol>
      <li>If a user agent encounters an element it does not recognize, it must continue to process the children of that element. If the content is text, the text must be presented to the user.</li>
      <li>If a user agent encounters an attribute it does not recognize, it must ignore the entire attribute specification (i.e., the attribute and its value).</li>
    </ol>
  </div>
</section1>
<section1 topic='Discovering Support for XHTML-IM' anchor='discovery'>
  <p>This section describes methods for discovering whether a Jabber client or other XMPP entity supports the protocol defined herein.</p>
  <section2 topic='Explicit Discovery' anchor='discovery-explicit'>
    <p>The primary means of discovering support for XHTML-IM is &xep0030; (or the dynamic profile of service discovery defined in &xep0115;).</p>
    <example caption='Seeking to Discover XHTML-IM Support'><![CDATA[
<iq type='get'
    from='juliet@shakespeare.lit/balcony'
    to='romeo@shakespeare.lit/orchard'
    id='disco1'>
  <query xmlns='http://jabber.org/protocol/disco#info'/>
</iq>
    ]]></example>
    <p>If the queried entity supports XHTML-IM, it MUST return a &lt;feature/&gt; element with a 'var' attribute set to a value of "http://jabber.org/protocol/xhtml-im" in the IQ result.</p>
    <example caption='Contact Returns Disco Info Results'><![CDATA[
<iq type='result'
    from='romeo@shakespeare.lit/orchard'
    to='juliet@shakespeare.lit/balcony'
    id='disco1'>
  <query xmlns='http://jabber.org/protocol/disco#info'>
    ...
    <feature var='http://jabber.org/protocol/xhtml-im'/>
    ...
  </query>
</iq>
    ]]></example>
    <p>Naturally, support can also be discovered via the dynamic, presence-based profile of service discovery defined in &xep0115;.</p>
  </section2>
  <section2 topic='Implicit Discovery' anchor='discovery-implicit'>
    <p>A Jabber user's client MAY send XML &MESSAGE; stanzas containing XHTML-IM extensions without first discovering if the conversation partner's client supports XHTML-IM. If the user's client sends a message that includes XHTML-IM markup and the conversation partner's client replies to that message but does not include XHTML-IM markup, the user's client SHOULD NOT continue sending XHTML-IM markup.</p>
  </section2>
</section1>
<section1 topic='Security Considerations' anchor='security'>
  <section2 topic='Malicious Objects' anchor='security-code'>
    <p>The exclusion of scripts, applets, binary objects, and other potentially executable code from XHTML-IM reduces the risk of exposure to harmful or malicious objects caused by inclusion of XHTML content. To further reduce the risk of such exposure, an implementation MAY choose to:</p>
    <ul>
      <li>Not make hyperlinks clickable</li>
      <li>Not fetch or present images but instead show only the 'alt' text.</li>
    </ul>
    <p>In addition, an implementation MUST make it possible for a user to prevent the automatic fetching and presentation of images (rather than leave it up to the implementation).</p>
  </section2>
  <section2 topic='Phishing' anchor='security-phishing'>
    <p>To reduce the risk of phishing attacks <note>Phishing has been defined by the Financial Services Technology Consortium Counter-Phishing Initiative as "a broadly launched social engineering attack in which an electronic identity is misrepresented in an attempt to trick individuals into revealing personal credentials that can be used fraudulently against them".</note>, an implementation MAY choose to:</p>
    <ul>
      <li>Display the value of the XHTML 'href' attribute instead of the XML character data of the &lt;a/&gt; element.</li>
      <li>Display the value of XHTML 'href' attribute in addition to the XML character data of the &lt;a/&gt; element if the two values do not match.</li>
    </ul>
  </section2>
  <section2 topic='Presence Leaks' anchor='security-presence'>
    <p>The network availability of the receiver may be revealed if the receiver's client automatically loads images or the receiver clicks a link included in a message. Therefore an implementation MAY choose to:</p>
    <ul>
      <li>Not fetch images offered by senders that are not authorized to view the receiver's presence.</li>
      <li>Warn the receiver before allowing the user to visit a URI provided by the sender.</li>
    </ul>
  </section2>
</section1>
<section1 topic='W3C Considerations' anchor='w3c'>
  <p>The usage of XHTML 1.0 defined herein meets the requirements for XHTML 1.0 Integration Set document type conformance as defined in Section 3 ("Conformance Definition") of <cite>Modularization of XHTML</cite>.</p>
  <section2 topic='Document Type Name' anchor='w3c-doctype'>
    <p>The Formal Public Identifier (FPI) for the XHTML-IM document type definition is:</p>
    <code><![CDATA[
-//JSF//DTD Instant Messaging with XHTML//EN
    ]]></code>
    <p>The fields of this FPI are as follows:</p>
    <ol>
      <li>The leading field is "-", which indicates that this is a privately-defined resource.</li>
      <li>The second field is "JSF" (an abbreviation for Jabber Software Foundation, the former name for the &XSF;), which identifies the organization that maintains the named item.</li>
      <li>The third field contains two constructs:
        <ol>
          <li>The public text class is "DTD", which adheres to ISO 8879 Clause 10.2.2.1.</li>
          <li>The public text description is "Instant Messaging with XHTML", which contains but does not begin with the string "XHTML" (as recommended for an XHTML 1.0 Integration Set).</li>
        </ol>
      </li>
      <li>The fourth field is "EN", which identifies the language (English) in which the item is defined.</li>
    </ol>
  </section2>
  <section2 topic='User Agent Conformance' anchor='w3c-conformance'>
    <p>A user agent that implements this specification MUST conform to Section 3.5 ("XHTML Family User Agent Conformance") of <cite>Modularization of XHTML</cite>. Many of the requirements defined therein are already met by Jabber clients simply because they already include XML parsers.</p>
    <p>However, "ignore" has a special meaning in XHTML modularization (different from its meaning in XMPP). Specifically, criteria 4 through 6 of Section 3.5 of <cite>Modularization of XHTML</cite> state:</p>
    <ol type='1' start='4'>
      <li>
        <p><em>W3C TEXT:</em> If a user agent encounters an element it does not recognize, it must continue to process the children of that element. If the content is text, the text must be presented to the user.</p>
        <p><em>XSF COMMENT:</em> This behavior is different from that defined by <cite>XMPP Core</cite>, and in the context of XHTML-IM implementations applies only to XML elements qualified by the 'http://www.w3.org/1999/xhtml' namespace as defined herein. This criterion MUST be applied to all XHTML 1.0 elements except those explicitly included in XHTML-IM as described in the <link url="#def">XHTML-IM Integration Set</link> and <link url='#profile'>Recommended Profile</link> sections of this document. Therefore, an XHTML-IM implementation MUST process all XHTML 1.0 child elements of the XHTML-IM &lt;html/&gt; element even if such child elements are not included in the XHTML 1.0 Integration Set defined herein, and MUST present to the recipient the XML character data contained in such child elements.</p>
      </li>
      <li>
        <p><em>W3C TEXT:</em> If a user agent encounters an attribute it does not recognize, it must ignore the entire attribute specification (i.e., the attribute and its value).</p>
        <p><em>XSF COMMENT:</em> This criterion MUST be applied to all XHTML 1.0 attributes except those explicitly included in XHTML-IM as described in the <link url="#def">XHTML-IM Integration Set</link> and <link url='#profile'>Recommended Profile</link> sections of this document. Therefore, an XHTML-IM implementation MUST ignore all attributes of elements qualified by the 'http://www.w3.org/1999/xhtml' namespace if such attributes are not explicitly included in the XHTML 1.0 Integration Set defined herein.</p>
      </li>
      <li>
        <p><em>W3C TEXT:</em> If a user agent encounters an attribute value it doesn't recognize, it must use the default attribute value.</p>
        <p><em>XSF COMMENT:</em> Since not one of the attributes included in XHTML-IM has a default value defined for it in <cite>XHTML 1.0</cite>, in practice this criterion does not apply to XHTML-IM implementations.</p>
      </li>
    </ol>
  </section2>
  <section2 topic='XHTML Modularization' anchor='w3c-modularization'>
    <p>For information regarding XHTML modularization in XML schema for the XHTML 1.0 Integration Set defined in this specification, refer to the <link url="#schemas-driver">Schema Driver</link> section of this document.</p>
  </section2>
  <section2 topic='W3C Review' anchor='w3c-review'>
    <p>The XHTML 1.0 Integration Set defined herein has been reviewed informally by an editor of the <cite>XHTML Modularization in XML Schema</cite> specification but has not undergone formal review by the W3C. Before the XHTML-IM specification proceeds to a status of Final within the standards process of the XMPP Standards Foundation, the &COUNCIL; is encouraged to pursue a formal review through communication with the Hypertext Coordination Group within the W3C.</p>
  </section2>
  <section2 topic='XHTML Versioning' anchor='w3c-versions'>
    <p>The W3C is actively working on &w3xhtml2; and may produce additional versions of XHTML in the future. This specification addresses XHTML 1.0 only, but it may be superseded or supplemented in the future by a XMPP Extension Protocol specification that defines methods for encapsulating XHTML 2.0 content in XMPP.</p>
  </section2>
</section1>
<section1 topic='IANA Considerations' anchor='iana'>
  <p>This document requires no interaction with &IANA;.</p>
</section1>
<section1 topic='XMPP Registrar Considerations' anchor='registrar'>
  <section2 topic='Protocol Namespaces' anchor='registrar-ns'>
    <p>The &REGISTRAR; includes 'http://jabber.org/protocol/xhtml-im' in its registry of protocol namespaces.</p>
  </section2>
</section1>
<section1 topic='XML Schemas' anchor='schemas'>
  <section2 topic='XHTML-IM Wrapper' anchor='schemas-wrapper'>
    <p>The following schema defines the XMPP extension element that serves as a wrapper for XHTML content.</p>
    <code><![CDATA[
<?xml version='1.0' encoding='UTF-8'?>

<xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    xmlns:xhtml='http://www.w3.org/1999/xhtml'
    targetNamespace='http://jabber.org/protocol/xhtml-im'
    xmlns='http://jabber.org/protocol/xhtml-im'
    elementFormDefault='qualified'>

  <xs:import namespace='http://www.w3.org/1999/xhtml'
             schemaLocation='http://www.w3.org/2002/08/xhtml/xhtml1-strict.xsd'/>

  <xs:annotation>
    <xs:documentation>

      This schema defines the <html/> element qualified by
      the 'http://jabber.org/protocol/xhtml-im' namespace.
      The only allowable child is a <body/> element qualified
      by the 'http://www.w3.org/1999/xhtml' namespace. Refer 
      to the XHTML-IM schema driver for the definition of the 
      XHTML 1.0 Integration Set.

      Full documentation of this Integration Set is contained in
      "XEP-0071: XHTML-IM", a specification published by the
      XMPP Standards Foundation.

         http://www.xmpp.org/extensions/xep-0071.html

    </xs:documentation>
    <xs:documentation source="http://www.xmpp.org/extensions/xep-0071.html"/>
  </xs:annotation>

  <xs:element name='html'>
    <xs:complexType>
      <xs:sequence>
        <xs:element ref='xhtml:body' 
                    minOccurs='0' 
                    maxOccurs='unbounded'/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>

</xs:schema>
    ]]></code>
  </section2>
  <section2 topic='XHTML-IM Schema Driver' anchor='schemas-driver'>
    <p>The following schema defines the modularization schema driver for XHTML-IM.</p>
    <code><![CDATA[
<?xml version='1.0' encoding='UTF-8'?>

<xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://www.w3.org/1999/xhtml'
    xmlns='http://www.w3.org/1999/xhtml'
    elementFormDefault='qualified'>

  <xs:annotation>
    <xs:documentation>

      This is the XML Schema driver for XHTML-IM, an XHTML 1.0
      Integration Set for use in exchanging marked-up instant
      messages between entities that conform to the Extensible
      Messaging and Presence Protocol (XMPP). This Integration
      Set includes a subset of the modules defined for XHTML 1.0
      but does not redefine any existing modules, nor does it
      define any new modules. Specifically, it includes the
      following modules only:

         - Structure
         - Text
         - Hypertext
         - List
         - Image
         - Style Attribute
     
      The Formal Public Identifier (FPI) for this Integration
      Set is:

         -//JSF//DTD Instant Messaging with XHTML//EN

      Full documentation of this Integration Set is contained in
      "XEP-0071: XHTML-IM", a specification published by the
      XMPP Standards Foundation, which is available at the
      following URL:

         http://www.xmpp.org/extensions/xep-0071.html

    </xs:documentation>
    <xs:documentation source="http://www.xmpp.org/extensions/xep-0071.html"/>
  </xs:annotation>

  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-blkphras-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-blkstruct-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-hypertext-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-image-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-inlphras-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-inlstruct-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-inlstyle-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-list-1.xsd"/>
  <xs:include 
      schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml-struct-1.xsd"/>

</xs:schema>
    ]]></code>
  </section2>
  <section2 topic='XHTML-IM Content Model' anchor='schemas-model'>
    <p>The following schema defines the content model for XHTML-IM.</p>
    <code><![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           targetNamespace="http://www.w3.org/1999/xhtml"
           xmlns="http://www.w3.org/1999/xhtml">

  <xs:annotation>
    <xs:documentation>

      This is the XML Schema module of named XHTML 1.0 content models 
      for XHTML-IM, an XHTML 1.0 Integration Set for use in exchanging 
      marked-up instant messages between entities that conform to 
      the Extensible Messaging and Presence Protocol (XMPP). This 
      Integration Set includes a subset of the modules defined for 
      XHTML 1.0 but does not redefine any existing modules, nor 
      does it define any new modules. Specifically, it includes the 
      following modules only:

         - Structure
         - Text
         - Hypertext
         - List
         - Image
         - Style Attribute
     
      Therefore XHTML-IM uses the following content models:

          Block.mix;            Block-like elements, e.g., paragraphs
          Flow.mix;             Any block or inline elements
          Inline.mix;           Character-level elements
          InlineNoAnchor.class; Anchor element
          InlinePre.mix;        Pre element

      XHTML-IM also uses the following Attribute Groups:

           Core.extra.attrib
           I18n.extra.attrib
           Common.extra

      Full documentation of this Integration Set is contained in
      "XEP-0071: XHTML-IM", a specification published by the
      XMPP Standards Foundation.

         http://www.xmpp.org/extensions/xep-0071.html

    </xs:documentation>
    <xs:documentation source="http://www.xmpp.org/extensions/xep-0071.html"/>
  </xs:annotation>

  <!-- BEGIN ATTRIBUTE GROUPS -->

  <xs:attributeGroup name="Core.extra.attrib"/>
  <xs:attributeGroup name="I18n.extra.attrib"/>
  <xs:attributeGroup name="Common.extra">
    <xs:attributeGroup ref="style.attrib"/>
  </xs:attributeGroup>

  <!-- END ATTRIBUTE GROUPS -->

  <!-- BEGIN HYPERTEXT MODULE "PRIMITIVES" -->

  <xs:group name="Anchor.class">
    <xs:sequence>
      <xs:element ref="a"/>
    </xs:sequence>
  </xs:group>

  <!-- END HYPERTEXT MODULE "PRIMITIVES" -->

  <!-- BEGIN IMAGE MODULE "PRIMITIVES" -->

  <xs:group name="Image.class">
    <xs:choice>
      <xs:element ref="img"/>
    </xs:choice>
  </xs:group>

  <!-- END IMAGE MODULE "PRIMITIVES" -->

  <!-- BEGIN LIST MODULE "PRIMITIVES" -->

  <xs:group name="List.class">
    <xs:choice>
      <xs:element ref="ul"/>
      <xs:element ref="ol"/>
      <xs:element ref="dl"/>
    </xs:choice>
  </xs:group>

  <!-- END LIST MODULE "PRIMITIVES" -->

  <!-- BEGIN TEXT MODULE "PRIMITIVES" -->

  <xs:group name="BlkPhras.class">
    <xs:choice>
      <xs:element ref="address"/>
      <xs:element ref="blockquote"/>
      <xs:element ref="pre"/>
    </xs:choice>
  </xs:group>

  <xs:group name="BlkStruct.class">
    <xs:choice>
      <xs:element ref="div"/>
      <xs:element ref="p"/>
    </xs:choice>
  </xs:group>

  <xs:group name="Heading.class">
    <xs:choice>
      <xs:element ref="h1"/>
      <xs:element ref="h2"/>
      <xs:element ref="h3"/>
      <xs:element ref="h4"/>
      <xs:element ref="h5"/>
      <xs:element ref="h6"/>
    </xs:choice>
  </xs:group>

  <xs:group name="InlPhras.class">
    <xs:choice>
      <xs:element ref="abbr"/>
      <xs:element ref="acronym"/>
      <xs:element ref="cite"/>
      <xs:element ref="code"/>
      <xs:element ref="dfn"/>
      <xs:element ref="em"/>
      <xs:element ref="kbd"/>
      <xs:element ref="q"/>
      <xs:element ref="samp"/>
      <xs:element ref="strong"/>
      <xs:element ref="var"/>
    </xs:choice>
  </xs:group>

  <xs:group name="InlStruct.class">
    <xs:choice>
      <xs:element ref="br"/>
      <xs:element ref="span"/>
    </xs:choice>
  </xs:group>

  <!-- END TEXT MODULE "PRIMITIVES" -->

  <!-- BEGIN BLOCK COMBINATIONS -->

  <xs:group name="Block.class">
    <xs:choice>
      <xs:group ref="BlkPhras.class"/>
      <xs:group ref="BlkStruct.class"/>
    </xs:choice>
  </xs:group>

  <!-- END BLOCK COMBINATIONS -->

  <!-- BEGIN INLINE COMBINATIONS -->

  <!-- Any inline content -->
  <xs:group name="Inline.class">
    <xs:choice>
      <xs:group ref="Anchor.class"/>
      <xs:group ref="Image.class"/>
      <xs:group ref="InlPhras.class"/>
      <xs:group ref="InlStruct.class"/>
    </xs:choice>
  </xs:group>

  <!-- Inline content contained in a hyperlink -->
  <xs:group name="InlNoAnchor.class">
    <xs:choice>
      <xs:group ref="Image.class"/>
      <xs:group ref="InlStruct.class"/>
      <xs:group ref="InlPhras.class"/>
    </xs:choice>
  </xs:group>

  <!-- END INLINE COMBINATIONS -->

  <!-- BEGIN TOP-LEVEL MIXES -->

  <xs:group name="Block.mix">
    <xs:choice>
      <xs:group ref="Block.class"/>
      <xs:group ref="Heading.class"/>
      <xs:group ref="List.class"/>
    </xs:choice>
  </xs:group>

  <xs:group name="Flow.mix">
    <xs:choice>
      <xs:group ref="Block.class"/>
      <xs:group ref="Heading.class"/>
      <xs:group ref="Inline.class"/>
      <xs:group ref="List.class"/>
    </xs:choice>
  </xs:group>

  <xs:group name="Inline.mix">
    <xs:choice>
      <xs:group ref="Inline.class"/>
    </xs:choice>
  </xs:group>

  <xs:group name="InlNoAnchor.mix">
    <xs:choice>
      <xs:group ref="InlNoAnchor.class"/>
    </xs:choice>
  </xs:group>

  <xs:group name="InlinePre.mix">
    <xs:choice>
      <xs:group ref="Anchor.class"/>
      <xs:group ref="InlPhras.class"/>
      <xs:group ref="InlStruct.class"/>
    </xs:choice>
  </xs:group>

  <!-- END TOP-LEVEL MIXES -->

</xs:schema>
    ]]></code>
  </section2>
</section1>
<section1 topic='Acknowledgements' anchor='ack'>
  <p>This specification formalizes and extends earlier work by Jeremie Miller and Julian Missig on XHTML formatting of Jabber messages. Many thanks to Shane McCarron for his assistance regarding XHTML modularization and conformance issues. Thanks also to contributors on the discussion list of the XSF's &SSIG; for their feedback and suggestions.</p>
</section1>
</xep>
